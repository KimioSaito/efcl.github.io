<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Web Scratch</title>
 <link href="http://efcl.info/feed/atom/" rel="self"/>
 <link href="http://efcl.info"/>
 <updated>2016-06-09T12:40:20+09:00</updated>
 <id>http://efcl.info/</id>
 
 <author>
   <name>azu</name>
   
 </author>
 

 
 <entry>
   <title>AWS lambdaでGitHubのアクティビティをTwitterで読む用に投稿する</title>
   <link href="http://efcl.info/2016/06/09/github-to-twitter-lambda/"/>
   <updated>2016-06-09T09:52:00+09:00</updated>
   <id>http://efcl.info/2016/06/09/github-to-twitter-lambda</id>
   <content type="html"><![CDATA[ <p>タイトルどおりですが、<a href="https://aws.amazon.com/jp/lambda/" title="AWS Lambda">AWS Lambda</a>を使って、GitHubのWatchやアクティビティをTwitterに投げるlambda functionを書きました。</p>

<ul>
<li><a href="https://github.com/azu/github-to-twitter-lambda" title="azu/github-to-twitter-lambda: Lambda bot that fetch own GitHub notifications/events and post to Twitter.">azu/github-to-twitter-lambda: Lambda bot that fetch own GitHub notifications/events and post to Twitter.</a></li>
</ul>

<p>こんな感じでTwitterにGitHubの<a href="https://github.com/notifications">Notification</a>(Watch)、<a href="https://github.com/">アクティビティ</a>が流れます。</p>

<p><img src="http://efcl.info/wp-content/uploads/2016/06/09-1465433692.png" alt="on Twitter"></p>

<p><strong>注意</strong>: メインで使ってるGitHubアカウントのPersonal Tokenを使うとそのアカウントのNotificationとタイムラインが流れるので、privateの情報とかもなげられてしまうので注意です。</p>

<p>ローカルだけで完結したい場合は以下のようなクライアントで動くタイプのものを利用したほうが良いです。</p>

<ul>
<li><a href="https://github.com/azu/github-reader" title="azu/github-reader: [node-webkit] GitHub client app - Viewer for Notifications and News Feed.">azu/github-reader: [node-webkit] GitHub client app - Viewer for Notifications and News Feed.</a></li>
</ul>

<p>GitHubのWatchやアクティビティは読むのが困難なデザインなので、基本読み飛ばしていいTwitterにまとめてしまうと楽な感じがしたので作りました。</p>

<p>自分が関係するような見逃したくない情報は、別の方法で見たほうがいいと思います。</p>

<ul>
<li><a href="https://github.com/pulls">Pull Requests</a></li>
<li><a href="https://github.com/issues">Issues</a></li>
<li><a href="https://github.com/issues/assigned">Issues assigned</a></li>
<li><a href="http://blog.h13i32maru.jp/entry/2016/06/08/090000">JasperというGitHub Issue Readerを作りました - maru source</a></li>
<li><a href="http://efcl.info/2015/07/30/github-issue-manager/">自分に関係するGitHub Issueを一覧できるアプリを書いた | Web Scratch</a></li>
</ul>

<p>導入はREADME通りにやっても動かない場合がありそうなので、そこは頑張って…(Pull Request下さい)</p>

<h2 id="必要なもの">必要なもの</h2>

<ul>
<li><a href="https://github.com/apex/apex" title="Apex">Apex</a>のインストール</li>
<li>GitHub token(情報元)</li>
<li>Twitter token(ポスト先)</li>
<li>AWSのアカウント</li>
<li>lambda</li>
<li>dynamodb</li>
</ul>

<h2 id="インストール">インストール</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text"> git clone https://github.com/azu/github-to-twitter-lambda.git
cd github-to-twitter-lambda/functions/notifications
npm install
npm run init
# dynamodbのテーブルを作る
</code></pre></div>
<p>dynamodbをロックファイル代わりというか、前回実行した時間の記録だけに使っています。
lambdaとdynamodbは毎月無料枠があるので、基本的にこのlambda functionでかかる費用は $0から$1以内になる感じです。
(2分に1回</p>

<h3 id="config">Config</h3>

<p>サンプルの設定があるのでコピーして編集します。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cp project.example.json project.json
</code></pre></div>
<ul>
<li><code>role</code> はApexのドキュメントに書かれてるようにlambdaの実行するRoleです

<ul>
<li>後述するpolicyを指定しています。</li>
</ul></li>
<li><code>environment</code>は環境変数的な感じですが、ここにToken類を入れています。

<ul>
<li>実行時に環境変数でも行けるはず</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">    &quot;role&quot;: &quot;arn:aws:iam::xxxxxxxxxxxx&quot;,
    &quot;defaultEnvironment&quot;: &quot;dev&quot;,
    &quot;environment&quot;: {
        &quot;GITHUB_TOKEN&quot;: &quot;GitHub Person token need repo/notification/user&quot;,
        &quot;TWITTER_CONSUMER_KEY&quot;: &quot;app key&quot;,
        &quot;TWITTER_CONSUMER_SECRET&quot;: &quot;app secret&quot;,
        &quot;TWITTER_ACCESS_TOKEN_KEY&quot;: &quot;token key&quot;,
        &quot;TWITTER_ACCESS_TOKEN_SECRET&quot;: &quot;token  secret&quot;
    }
</code></pre></div>
<h3 id="lambda-role-policy">Lambda role policy</h3>

<p>Lambda(<code>role&quot;: &quot;arn:aws:iam::xxxxxxxxxxxx&quot;</code>)のroleに指定するpolicyは以下のような感じになってます。
<code>&quot;lambda:*&quot;</code>と<code>&quot;cloudwatch:*&quot;</code>があればとりあえず動く気がします。</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;dynamodb:*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lambda:*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs:*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudwatch:*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:Describe*&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="deploy">Deploy</h3>

<p><a href="https://github.com/apex/apex" title="Apex">Apex</a>を使ってデプロイします。
<code>aws configure</code> とかで awsのAPIキーとかを設定しておかないと当然デプロイできません。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">apex deploy notifications
</code></pre></div>
<p>詳細は<a href="https://github.com/apex/apex" title="Apex">Apex</a>のドキュメントや以下を見て下さい。</p>

<ul>
<li><a href="http://dev.classmethod.jp/cloud/aws/how-to-manage-aws-lambda-functions-with-apex/" title="ApexでAWS Lambdaファンクションを管理する ｜ Developers.IO">ApexでAWS Lambdaファンクションを管理する ｜ Developers.IO</a></li>
</ul>

<h3 id="test">Test</h3>

<p>ローカルでdry-runしたい場合は test.js というのがあるのでそれを実行するといけます(実際にpostはしない)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cd functions/notifications
npm test
</code></pre></div>
<p><a href="https://github.com/apex/apex" title="Apex">Apex</a>を使って、手元からlambdaを叩いてテストもできます。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">apex invoke notifications
</code></pre></div>
<h3 id="cron">Cron</h3>

<p>lambdaはデフォルトだと１回実行して終わりなので繰り返し実行することでBotとして動かします
(lambdaの実行回数による料金は基本無料枠で納まります)</p>

<p><a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-scheduled-events.html" title="スケジュールされたイベントでの AWS Lambda の使用 - AWS Lambda">スケジュールされたイベントでの AWS Lambda の使用 - AWS Lambda</a>を使うことで、Cron的に繰り返し実行を設定できます。</p>

<p>自分は2分に一度とかに設定しています。</p>

<p><img src="https://monosnap.com/file/lhJghW8bwKJmTZ3iDugi4B7eklRn5Z.png" alt="image"></p>

<h2 id="まとめ">まとめ</h2>

<ul>
<li>GitHubのWatchは破綻してる</li>
<li>GitHub -&gt; Twitter</li>
<li>TwitterでGitHubを読めるようにした</li>
<li>Slackは未読に厳しい</li>
<li>未読を読み飛ばしやすいのはやっぱりTwitterかRSSリーダー</li>
<li>RSSリーダーもコンテキストが異なる物量には弱い

<ul>
<li>RSSリーダーはリリースノートだけに絞ってる</li>
<li><a href="http://efcl.info/2014/07/30/find-github-release/" title="GitHubでライブラリのリリースを見ていくためのツールや方法 | Web Scratch">GitHubでライブラリのリリースを見ていくためのツールや方法 | Web Scratch</a></li>
</ul></li>
<li><a href="http://www.misuzilla.org/Distribution/TweetIrcGateway/" title="TweetIrcGateway">TweetIrcGateway</a>っぽい</li>
<li>それぞれのコンテキストにあった読みやすさがあるので、読みやすい場所に読みたいものを置く</li>
<li>そういう土管ツールが簡単につくれるともっと良さそう</li>
</ul>
 ]]></content>
 </entry>
 
 <entry>
   <title>JavaScript Plugin Architectureというプラグイン設計について学ぶ無料の電子書籍を書いた</title>
   <link href="http://efcl.info/2016/06/06/JavaScript-Plugin-Architecture/"/>
   <updated>2016-06-06T09:36:00+09:00</updated>
   <id>http://efcl.info/2016/06/06/JavaScript-Plugin-Architecture</id>
   <content type="html"><![CDATA[ <p><a href="https://github.com/azu/JavaScript-Plugin-Architecture" title="JavaScript Plugin Architecture">JavaScript Plugin Architecture</a>というJavaScriptのプラグイン設計についての電子書籍を書きました。</p>

<p>この書籍はJavaScriptのライブラリやツールにおけるプラグインアーキテクチャについて見ていく事を目的としたものです。</p>

<p>以下の形式で読むことができます。</p>

<ul>
<li><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/">Web版</a></li>
<li><a href="https://www.gitbook.com/download/pdf/book/azu/javascript-plugin-architecture">PDF形式</a> - <a href="https://github.com/azu/JavaScript-Plugin-Architecture/issues/106">レンダリングに難あり</a></li>
<li><a href="https://www.gitbook.com/download/epub/book/azu/javascript-plugin-architecture">ePub形式</a></li>
<li><a href="https://www.gitbook.com/download/mobi/book/azu/javascript-plugin-architecture">Mobi形式</a></li>
</ul>

<p><a href="https://github.com/azu/JavaScript-Plugin-Architecture">GitHub</a>上にソースコードも公開されているでので直接Markdownファイルを読むこともできます。
Markdownよりは<a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/">Web版</a>の方が見やすいのでそちらをオススメします。</p>

<p>Twitterのハッシュタグは<a href="https://twitter.com/search?f=tweets&amp;q=%23js_plugin_book&amp;src=typd" title="Twitter #js_plugin_book">#js_plugin_book</a></p>

<p>更新情報は<a href="https://github.com/azu/JavaScript-Plugin-Architecture/releases.atom">RSS</a>や<a href="https://github.com/azu/JavaScript-Plugin-Architecture/releases">リリースノート</a>から見ることができます。</p>

<h2 id="v1-0-0">v1.0.0</h2>

<p>最初に<a href="https://github.com/azu/JavaScript-Plugin-Architecture/issues?q=label%3Aproposal+is%3Aclosed">書くと決めたプラグインアーキテクチャ</a>が揃ったので<a href="https://github.com/azu/JavaScript-Plugin-Architecture/releases/tag/1.0.0" title="1.0.0">1.0.0</a>としてリリースしました。
<a href="http://azu.github.io/promises-book/" title="JavaScript Promiseの本">JavaScript Promiseの本</a>の時と同じく、継続的に更新できる仕組みを色々入れてあるので新しいプラグインアーキテクチャのProposalが出たら書いていく感じになると思います。</p>

<ul>
<li><a href="http://efcl.info/2014/0623/res3943/" title="JavaScript Promiseの本を書きました | Web Scratch">JavaScript Promiseの本を書きました | Web Scratch</a></li>
</ul>

<p>このツール/ライブラリで使われてるプラグインの仕組みは面白いというようなものがあれば、ProposalをIssueに書いてみてください。
<a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/master/CONTRIBUTING.md" title="CONTRIBUTING.md">CONTRIBUTING.md</a>にProposalの書き方を載せています。</p>

<h2 id="はじめに">はじめに</h2>

<p>JavaScriptの世界では1つの大きなライブラリよりも小さいなものを組み合わせていくようなスタイルが多く見られます。
小さなものを組み合わせて作るためには、プラグインと呼ばれるような拡張の仕組みが必要となります。
またそのようなプラグインがたくさんあるエコシステムの土台を作るには、プラグインアーキテクチャが重要になると言えます。</p>

<blockquote>
<p>ソフトウェアの構造に「プラグイン機構」を設け、ユーザコミュニティから開発者コミュニティへの質的な転換を図るのは、ソフトウェア設計からエコシステム設計へとつながる<br>
-- <a href="http://t-wada.hatenablog.jp/entry/active-oss-development-vs-simplicity" title="OSS開発の活発さの維持と良いソフトウェア設計の間には緊張関係があるのだろうか? - t-wadaのブログ">OSS開発の活発さの維持と良いソフトウェア設計の間には緊張関係があるのだろうか? - t-wadaのブログ</a></p>
</blockquote>

<p>この書籍では、JavaScriptにおけるプラグインアーキテクチャやそのエコシステムを形成してるライブラリやツールなどの実装を学ぶことが目的となっています。</p>

<p>何も断りなしにECMAScript 2015で書いてて、JavaScriptの文法の説明は基本的にしてないのでご了承ください。</p>

<h2 id="この書籍の内容について">この書籍の内容について</h2>

<p>現状の書籍の概要をまとめてると以下のようなライブラリやツールについて書かれています。
大体の章は<a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/master/CONTRIBUTING.md#proposal%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9" title="Proposal">Proposal</a>に沿って書いていたので、次のような項目になっています。</p>

<ul>
<li>どう書ける?</li>
<li>どういう仕組み?</li>
<li>実装してみよう</li>
<li>どういう用途に向いている?</li>
<li>どういう用途に向いていない?</li>
<li>この仕組みを使っているもの</li>
<li>エコシステム</li>
</ul>

<h3 id="jquery"><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/jQuery/">jQuery</a></h3>

<p>jQueryのプラグインについて解説しています。
<code>&lt;script&gt;</code>タグをベースとしたプラグインアーキテクチャについて解説しています。</p>

<h3 id="eslint"><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/ESLint/">ESLint</a></h3>

<p>ESLintのルールを拡張する仕組みについて解説しています。
ESLintではJavaScriptのコードをパースして作成されたASTを元にコードのLintを行います。
実際にESLintのルールを解釈できる小さな実装を作りながらプラグインの仕組みについて学びます。</p>

<h3 id="connect"><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/connect/">Connect</a></h3>

<p>Connectの <strong>middleware</strong> と呼ばれるプラグインアーキテクチャについて解説しています。
Node.js以外においても<em>Rack</em>などHTTPサーバーでよく見られるプラグインを使った階層構造について学びます。</p>

<h3 id="gulp"><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/gulp/">gulp</a></h3>

<p><strong>タスク自動化ツール</strong>として知られるgulpのプラグインアーキテクチャについて解説しています。
gulpではデータの流れとして既存のNode.js Streamを使い、そこで流すデータとしてvinylオブジェクトを利用します。
実際にgulpプラグインを書きながら、gulpのプラグインの仕組みについて学びます。</p>

<h3 id="redux"><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/Redux/">Redux</a></h3>

<p>アプリケーションのStateを管理ライブラリのReduxのプラグインアーキテクチャについて解説しています。
Reduxでは <strong>Middleware</strong> と呼ばれる拡張の仕組みを持っていますが、Connectとの類似点や相違点があります。
小さなReduxの実装を作りながら <strong>Middleware</strong> の仕組みについて学びます。</p>

<h2 id="contributing">Contributing</h2>

<p>この書籍は無料で読むことができ、同時に修正や新しいページを書く権利があります。</p>

<p><a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>に、書籍で扱うべきプラグインアーキテクチャのProposalの書き方や
Pull Request、コミットのやりかたなどが書かれています。</p>

<p>間違いやライブラリのアップデートへの追従など何かあれば、IssueやPull Requestをよろしくお願いします。</p>

<p>ソースコードは全てGitHubに公開されています。</p>

<ul>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture">azu/JavaScript-Plugin-Architecture</a></li>
</ul>

<h2 id="license">License</h2>

<p>MIT/CC BY-NC © azu</p>

<ul>
<li>コードはMITライセンスで利用できます</li>
<li>文章は<a href="http://creativecommons.org/licenses/by-nc/4.0/" title="CC BY-NC 4.0">CC BY-NC 4.0</a>で利用できます</li>
</ul>

<h2 id="もう一つの目的">もう一つの目的</h2>

<p>この書籍のテーマは、先ほど書いたようにプラグインの仕組みについて学ぶという目的を持っています。
しかし、この書籍を書くことにした目的はまた別にあります。</p>

<p>以下のIssueがこの書籍の起点となっています。</p>

<ul>
<li><a href="https://github.com/azu/azu/issues/60" title="色々なプラグイン機構のパターン · Issue #60 · azu/azu">色々なプラグイン機構のパターン · Issue #60 · azu/azu</a></li>
</ul>

<p>このIssueよりさらに前に、電子書籍の開発環境について考えるというIssueが目的の半分です。</p>

<blockquote>
<p>目的: もっと気軽に書ける電子書籍
もっと簡単に色々自動化できる電子書籍の書き方についてを考える。</p>
</blockquote>

<ul>
<li><a href="https://github.com/azu/azu/issues/42">[Markdown] 電子書籍開発環境 · Issue #42 · azu/azu</a></li>
</ul>

<p>この書籍を書きながら考えた電子書籍のセットアップや継続的な開発については以下などで発表しています。</p>

<ul>
<li><a href="http://efcl.info/2015/09/28/easy-to-create-ebook/">今すぐ電子書籍(技術書)を書き始める方法と文章の自動チェック | Web Scratch</a></li>
<li><a href="https://azu.gitbooks.io/nodefest-technical-writing/content/">Introduction | 技術文書をソフトウェア開発する話</a></li>
</ul>

<p>いつもどおり<a href="http://azu.github.io/promises-book/#about-author">手段と目的が逆転</a>しているので、
<a href="https://github.com/textlint/textlint" title="textlint">textlint</a>の開発を進めるためにこの書籍を開発していた部分も大きいです。</p>

<p>textlintで日本語の文章をチェックするために論文やRedPenなど既存のLinterを参考に色々なルールを実装しましたが、ルールの実験場として<a href="https://github.com/azu/JavaScript-Plugin-Architecture" title="JavaScript Plugin Architecture">JavaScript Plugin Architecture</a>を使っていました。</p>

<ul>
<li><a href="https://github.com/textlint/textlint/wiki/Collection-of-textlint-rule" title="Collection of textlint rule · textlint/textlint Wiki">Collection of textlint rule · textlint/textlint Wiki</a></li>
</ul>

<p>自分が実装するtextlintのルールはfalse positiveにならない事を目標にしています。
そのルールに問題ないかを測ることができ、ある程度量があり、自由にいじれる文章が欲しかったので<a href="https://github.com/azu/JavaScript-Plugin-Architecture" title="JavaScript Plugin Architecture">JavaScript Plugin Architecture</a>を書いていた部分もあります。</p>

<p>なので、JavaScript Plugin Architectureの<a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/master/.textlintrc" title=".textlintrc">.textlintrc</a>はいろんなルールが詰め込まれています。
(後で整理してプリセットとか作るかもしれません。)</p>

<p><a href="https://azu.gitbooks.io/nodefest-technical-writing/content/">技術文書をソフトウェア開発する話</a>でも書いてましたが、自然言語はプログラミング言語と違って正解がないので、汎用的なルールを作るのは結構難しいです。</p>

<blockquote>
<p>自然言語処理のほとんどの技術は形態素解析が正しく行われていることを前提に設計されているので、
(中略) 文字レベルで誤った日本語入力に対する校正の大部分は当面困難と予想する。
残念ながら誤った日本語入力に対する形態素解析の研究はきわめて少ないのが現状
-- <a href="%E8%87%AA%E7%84%B6%E8%A8%80%E8%AA%9E%E5%87%A6%E7%90%86%E6%8A%80%E8%A1%93%E3%81%AE%E7%8F%BE%E7%8A%B6%E3%81%A8%E5%B1%95%E6%9C%9B">https://ipsj.ixsq.nii.ac.jp/ej/index.php?action=pages_view_main&amp;active_action=repository_view_main_item_snippet&amp;index_id=8404&amp;pn=1&amp;count=20&amp;order=7&amp;lang=japanese&amp;page_id=13&amp;block_id=8</a></p>
</blockquote>

<p>とか書かれてるぐらいなので、textlintではルールを簡単に作って公開できる所に注力しています。
オレオレ<a href="http://efcl.info/2015/09/10/introduce-textlint/">ルール</a>、<a href="http://efcl.info/2016/04/08/textlint-sharable-config/">設定</a>や<a href="http://efcl.info/2015/12/30/textlint-preset/">プリセット</a>などをどんどん公開するといいです。</p>

<p>また、textlint自体もデフォルトでルールを持っていなかったり、プラガブルな実装になっています。</p>

<p>ルールを処理する仕組みはESLintと同じですが、<a href="https://github.com/textlint/textlint/blob/master/docs/plugin.md">パーサ</a>、<a href="https://github.com/textlint/textlint/blob/master/docs/rule.md">ルール</a>、ルールのエラーを無視する範囲を決める<a href="https://github.com/textlint/textlint/blob/master/docs/filter-rule.md">フィルタールール</a>、<a href="https://github.com/textlint/textlint/blob/master/src/messages/MessageProcessManager.js">フィルター実現するロジック</a>、<a href="https://github.com/textlint/textlint-formatter">出力フォーマッター</a>など大部分がプラガブルな実装です。</p>

<ul>
<li><a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/ESLint/" title="ESLint · JavaScript Plugin Architecture">ESLint · JavaScript Plugin Architecture</a></li>
</ul>

<p>そういうプラグインの実装方法についても<a href="https://github.com/azu/JavaScript-Plugin-Architecture" title="JavaScript Plugin Architecture">JavaScript Plugin Architecture</a>では書いているので、興味がある人は見てみてください。</p>

<h3 id="継続的に書く">継続的に書く</h3>

<p>継続的に書くにはやっぱりCIを回してテストしないと辛いので、JavaScript Plugin Architectureでは次のようなテストが走っています。</p>

<ul>
<li>サンプルコードのテスト

<ul>
<li>Mochaで動かすユニットテスト</li>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L28">https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L28</a></li>
</ul></li>
<li>サンプルコードの実行テスト

<ul>
<li><code>*-example.js</code>は単独で実行できるというルールにして実行させてエラーにならないかテスト</li>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L27">https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L27</a></li>
</ul></li>
<li>textlint

<ul>
<li>文章のチェック</li>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L26">https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L26</a></li>
</ul></li>
<li>ESLint

<ul>
<li>サンプルコードのスタイルチェック</li>
<li>インラインコードブロックで埋め込んだサンプルコードのチェック</li>
</ul></li>
<li>文章のカバレッジ

<ul>
<li><a href="http://efcl.info/2016/01/12/textlint-coverage/" title="textlintで文章カバレッジレポートを継続的に見ていく | Web Scratch">textlintで文章カバレッジレポートを継続的に見ていく | Web Scratch</a></li>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L32">https://github.com/azu/JavaScript-Plugin-Architecture/blob/dee986289576598d7f9725d84ab3ba4dcb961d57/package.json#L32</a></li>
</ul></li>
</ul>

<p>この辺をすぐ使えるGitBookのスターターキットも公開してるので興味がある人は触ってみると面白いかもしれません。</p>

<ul>
<li><a href="http://efcl.info/2015/09/28/easy-to-create-ebook/" title="今すぐ電子書籍(技術書)を書き始める方法と文章の自動チェック | Web Scratch">今すぐ電子書籍(技術書)を書き始める方法と文章の自動チェック | Web Scratch</a></li>
</ul>

<h2 id="おわりに">おわりに</h2>

<p><a href="https://github.com/azu/JavaScript-Plugin-Architecture" title="JavaScript Plugin Architecture">JavaScript Plugin Architecture</a>をひとまずリリースしました。
世の中にはまだまだおもしろいプラグインの仕組みがあるので、面白いものがあったら<a href="https://github.com/azu/JavaScript-Plugin-Architecture/blob/master/CONTRIBUTING.md#proposal%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9" title="Proposal">Proposal</a>のIssueを書いていただけると更新される気がします。</p>

<p>JavaScriptのライブラリを書くときにいろんなプラグインの仕組みをぱっと読めるものがあると便利なので、
他にも面白い仕組みの話を追加してくれる人も募集中です。</p>

<p>最近、プラガブルな<a href="https://github.com/azu/bellows-logger">ロガーライブラリ</a>を実装していて、<a href="https://azu.gitbooks.io/javascript-plugin-architecture/content/ja/connect/index.html" title="Connect · JavaScript Plugin Architecture">Connect · JavaScript Plugin Architecture</a>や<a href="https://github.com/azu/JavaScript-Plugin-Architecture/issues/101">Web Audio API</a>を参考にしたので、こういうのがあると便利です。</p>

<p>今現在、電子書籍を書く環境は簡単に揃います。
ブログでは収まらなそうなちょっとした内容を電子書籍という体裁でまとめてみたりすると面白いかもしれません。</p>

<blockquote>
<p>技術書は一日で書き終わらない
途中で飽きてしまう問題
-- <a href="https://azu.gitbooks.io/nodefest-technical-writing/content/slide/25.html" title="技術書を書く環境はできたが… | 技術文書をソフトウェア開発する話">技術書を書く環境はできたが… | 技術文書をソフトウェア開発する話</a></p>
</blockquote>

<p>今はまた別のJavaScript本を書いていますが、継続的に文書開発できる環境についてはまだまだ考える事が多そうです。</p>
 ]]></content>
 </entry>
 
 <entry>
   <title>Reactで条件によって出したり消したりするコンポーネントを書いた</title>
   <link href="http://efcl.info/2016/05/31/react-toggle-pattern/"/>
   <updated>2016-05-31T20:38:00+09:00</updated>
   <id>http://efcl.info/2016/05/31/react-toggle-pattern</id>
   <content type="html"><![CDATA[ <p><code>&lt;TogglePattern /&gt;</code> というコンポーネントを書きました。</p>

<ul>
<li><a href="https://github.com/azu/react-toggle-pattern" title="azu/react-toggle-pattern: React Component that provide toggle pattern">azu/react-toggle-pattern: React Component that provide toggle pattern</a></li>
</ul>

<p>名前の通りトグルするボタンとかを実装するのを想定して作りましたが、
もっと汎用的にパターンマッチ的な感じの制御ができるようになってます(A/Bテスト的なやつにも使えそう)</p>

<p>使い方は、<code>children</code>に表示が切り替わる要素を置く形で書くようになっています。
(こういう親になるコンポーネントってなんというのだろう?)</p>

<p>次の例では<code>isEditing</code>の値が</p>

<ul>
<li><code>true</code>ならば<code>LeaveEditingButton</code>が表示</li>
<li><code>false</code>ならば<code>EnterEditingButton</code>が表示</li>
</ul>

<p>という形になっています。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">TogglePattern</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;react-toggle-pattern&quot;</span><span class="p">;</span>
<span class="kr">class</span> <span class="nx">ToggleButton</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">(){</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">TogglePattern</span> <span class="nx">isEditing</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isEditing</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="nx">isEditing</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">EnterEditingButton</span> <span class="nx">isEditing</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="err">/TogglePattern&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>プログラム的に書くと以下の事をやっているのと同じです。
ViewからできるだけIf文を消すために、<code>TogglePattern</code>のような宣言的に書けるようにしています。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">toggleButton</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isEditing</span> 
                     <span class="o">?</span> <span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="o">/&gt;</span>
                     <span class="o">:</span> <span class="o">&lt;</span><span class="nx">EnterEditingButton</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>条件が1つだけならORかANDなのか気にしなくていいですが、<code>&lt;TogglePattern /&gt;</code>は複数条件にも対応しています。
<code>&lt;TogglePattern /&gt;</code>は<code>&lt;ToggleOrPattern /&gt;</code>のエイリアスです。</p>

<p><strong>OR</strong></p>

<p>OR条件で表示を制御したい場合は<code>&lt;ToggleOrPattern /&gt;</code>が利用できます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">ToggleOrPattern</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">EnterEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/ToggleOrPattern&gt;</span>
</code></pre></div>
<p>両方共条件を満たしているので、両方とも表示します。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;TogglePattern ToggleOrPattern&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">EnterEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</code></pre></div>
<p><strong>AND</strong></p>

<p>AND条件で表示を制御したい場合は<code>&lt;ToggleAndPattern /&gt;</code>が利用できます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">ToggleAndPattern</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">EnterEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/ToggleAndPattern&gt;</span>
</code></pre></div>
<p>これはAND条件でマッチするのは <code>LeaveEditingButton</code> だけなので、次のような結果になります。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">LeaveEditingButton</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>条件の値には真偽値以外も使えます。
次の例では<code>pattern</code>に指定した文字列と一致するものが表示されます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">TogglePattern</span> <span class="nx">pattern</span><span class="o">=</span><span class="s2">&quot;one&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">ComponentX</span> <span class="nx">pattern</span><span class="o">=</span><span class="s2">&quot;one&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">ComponentY</span> <span class="nx">pattern</span><span class="o">=</span><span class="s2">&quot;two&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/TogglePattern&gt;</span>
</code></pre></div>
<p>なので、結果は<code>&lt;ComponentY /&gt;</code>となります。</p>

<h2 id="実装">実装</h2>

<p>実装は大した事はやってないですが、テストを<a href="https://github.com/airbnb/enzyme" title="enzyme">enzyme</a>で書いています。
普通にReact Componentのテストを書けるので面白い感じがします。</p>

<ul>
<li><a href="https://github.com/azu/react-toggle-pattern/blob/master/test/react-toggle-pattern-test.js" title="react-toggle-pattern/react-toggle-pattern-test.js at master · azu/react-toggle-pattern">react-toggle-pattern/react-toggle-pattern-test.js at master · azu/react-toggle-pattern</a></li>
</ul>
 ]]></content>
 </entry>
 
 <entry>
   <title>textlintでAsciidoc/Asciidoctorをサポートするプラグイン</title>
   <link href="http://efcl.info/2016/05/08/textlint-support-asciidoc-loose/"/>
   <updated>2016-05-08T20:24:00+09:00</updated>
   <id>http://efcl.info/2016/05/08/textlint-support-asciidoc-loose</id>
   <content type="html"><![CDATA[ <p><a href="http://textlint.github.io/" title="textlint">textlint</a>で<a href="http://www.methods.co.nz/asciidoc/" title="AsciiDoc">AsciiDoc</a>/<a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a>を限定的にサポートするプラグインを書きました。</p>

<ul>
<li><a href="https://github.com/azu/textlint-plugin-asciidoc-loose" title="textlint-plugin-asciidoc-loose">textlint-plugin-asciidoc-loose</a></li>
</ul>

<h2 id="制限">制限</h2>

<p>今のところ<code>Paragarph</code>と<code>Str</code>しかサポートしていません。
他のNodeは単純に無視されるので、<code>Header</code>や<code>List</code>、<code>Link</code>などはないものと同じ扱いになっています。</p>

<p>簡単にいうと本文の文章をチェックするルールしか上手く動かないという感じです。</p>

<p>textlintのルールの大体は本文を対象としているので、<a href="https://github.com/textlint/textlint/wiki/Collection-of-textlint-rule" title="Collection of textlint rule · textlint/textlint Wiki">Collection of textlint rule</a>に書かれてるルールの8割ぐらいは動くような気がします。</p>

<p><code>Header</code>や<code>List</code>のサポートぐらいできたら結構良さそうな気がするので、Pull Request募集中です。</p>

<ul>
<li><a href="https://github.com/azu/textlint-plugin-asciidoc-loose/issues" title="Issues · azu/textlint-plugin-asciidoc-loose">Issues · azu/textlint-plugin-asciidoc-loose</a></li>
</ul>

<p>現状は<a href="http://motemen.hatenablog.com/entry/2016/04/textlint-asciidoc" title="AsciiDoc（Asciidoctor）の文書をtextlintで校正する - 詩と創作・思索のひろば">AsciiDoc（Asciidoctor）の文書をtextlintで校正する - 詩と創作・思索のひろば</a> と似ているかもしれません。</p>

<h2 id="インストール">インストール</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install textlint-plugin-asciidoc-loose
</code></pre></div>
<h2 id="使い方">使い方</h2>

<p><code>.textlintrc</code>の<code>&quot;plugins&quot;</code>に<code>&quot;asciidoc-loose&quot;</code>を追加すると有効になります。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">{
    &quot;plugins&quot;: [
        &quot;asciidoc-loose&quot;
    ]
}
</code></pre></div>
<p>以下の拡張子をAsciidocのファイルとして認識しています。</p>

<ul>
<li>&quot;.asciidoc&quot;,</li>
<li>&quot;.adoc&quot;,</li>
<li>&quot;.asc&quot;</li>
</ul>

<h2 id="例">例</h2>

<p><a href="http://azu.github.io/promises-book/" title="JavaScript Promiseの本">JavaScript Promiseの本</a>は<a href="https://github.com/azu/promises-book/search?l=asciidoc&amp;q=&amp;type=Code&amp;utf8=%E2%9C%93">Asciidoctorで書かれてる</a>で試しに<a href="http://textlint.github.io/" title="textlint">textlint</a>でLintしてみたら、エラー位置も正しく普通に動きました。</p>

<p><img src="http://efcl.info/wp-content/uploads/2016/05/08-1462706748.png" alt="textlint with asciidoc"></p>

<h2 id="注意">注意</h2>

<p>最初に書いた制限にあるように<code>Paragarph</code>と<code>Str</code>のみなので、<code>List</code>の中の<code>Str</code>は例外的に無視するみたいなルールが意図と異なる結果になったりする場合もあります。</p>

<ul>
<li><a href="https://github.com/azu/textlint-plugin-asciidoc-loose" title="textlint-plugin-asciidoc-loose">textlint-plugin-asciidoc-loose</a></li>
</ul>
 ]]></content>
 </entry>
 
 <entry>
   <title>敬体(ですます調)と常体(である調)の表記を統一するtextlintルール</title>
   <link href="http://efcl.info/2016/05/06/no-mixed-dearu-desumasu-2.0/"/>
   <updated>2016-05-06T15:21:00+09:00</updated>
   <id>http://efcl.info/2016/05/06/no-mixed-dearu-desumasu-2.0</id>
   <content type="html"><![CDATA[ <p><a href="http://textlint.github.io/" title="textlint">textlint</a>向けのルールとして敬体(ですます調)と常体(である調)を一つの文書内でどちらを使うか統一する<a href="https://github.com/azu/textlint-rule-no-mix-dearu-desumasu" title="textlint-rule-no-mix-dearu-desumasu">textlint-rule-no-mix-dearu-desumasu</a>というルールを書きました。</p>

<p>初期からあったのですが、<a href="https://github.com/takuyaa/kuromoji.js" title="kuromoji.js">kuromoji.js</a>で<a href="https://github.com/azu/textlint-rule-no-mix-dearu-desumasu/releases/tag/2.0.0">形態素解析した結果</a>をベースとしたり、明示的にどちらを<a href="https://github.com/azu/textlint-rule-no-mix-dearu-desumasu/releases/tag/2.2.0">優先するかのオプション</a>を追加したので改めて紹介します。</p>

<h2 id="インストール">インストール</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install textlint-rule-no-mix-dearu-desumasu
</code></pre></div>
<h2 id="使い方">使い方</h2>

<p><code>.textlintrc</code>(Recommended)に設定するのを推奨しています。
後述するオプション設定もできるのでこちらの方が便利です。</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;no-mix-dearu-desumasu&quot;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>CLIの<code>--rule</code>オプションだとデフォルト設定のみになります。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">textlint --rule no-mix-dearu-desumasu README.md
</code></pre></div>
<h2 id="オプション">オプション</h2>

<p>追記(2016-05-22): デフォルトでは <code>strict: false</code> にしています。
<code>strict:false</code>では少し緩めで文末のチェックのみ限定しているので、文中のチェックを入れたい場合は<code>strict: true</code>をオプションに加える必要があります。</p>

<p>このルールでは、本文、見出し、箇条書きをそれぞれ独立してチェックし、その項目内で表記が混在していないかを見つけます。
なので、本文と見出しの間で表記が混在するのは問題ありません。</p>

<ul>
<li>本文(Markdownなら通常の文章部分)</li>
<li>見出し(Markdownなら<code>#</code>)</li>
<li>箇条書き(Markdownなら<code>* item</code>や<code>- item</code>)</li>
</ul>

<p>それぞれの項目ごとに優先する表記をオプションで設定できます。</p>

<ul>
<li>本文(Body)</li>
<li>見出し(Header)</li>
<li>箇条書き(List)</li>
</ul>

<p>デフォルトは &quot;&quot;(空)で、多く使われている表記を自動的に優先します。
優先したい表記を &quot;である&quot; または &quot;ですます&quot; で指定します。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;no-mix-dearu-desumasu&quot;</span><span class="o">:</span> <span class="p">{</span>
             <span class="s2">&quot;preferInHeader&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="s2">&quot;preferInBody&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>   <span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="s2">&quot;preferInList&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>    <span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="c1">// 文末以外でも、敬体(ですます調)と常体(である調)を厳しくチェックするかどうか</span>
             <span class="s2">&quot;strict&quot;</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>例えば、以下の例だと</p>

<ul>
<li>見出しは&quot;自動&quot;(多く使われてる表記に統一を促す)</li>
<li>本文は&quot;ですます&quot;</li>
<li>箇条書きは&quot;である&quot;</li>
<li>Strict modeでチェック</li>
</ul>

<p>というルールでチェックします。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">&quot;rules&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;no-mix-dearu-desumasu&quot;</span><span class="o">:</span> <span class="p">{</span>
             <span class="s2">&quot;preferInHeader&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="s2">&quot;preferInBody&quot;</span><span class="o">:</span> <span class="s2">&quot;ですます&quot;</span><span class="p">,</span><span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="s2">&quot;preferInList&quot;</span><span class="o">:</span> <span class="s2">&quot;である&quot;</span><span class="p">,</span>    <span class="c1">// &quot;である&quot; or &quot;ですます&quot;</span>
             <span class="c1">// 文末以外でも、敬体(ですます調)と常体(である調)を厳しくチェックするかどうか</span>
             <span class="s2">&quot;strict&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>これは、本文と箇条書きで表記が異なるのは一般的によくあることなので、それぞれの項目ごとに設定できるようになっています。</p>

<h2 id="リファクタリング例">リファクタリング例</h2>

<p>このルールを使ってリファクタリングしてみた例です。</p>

<ul>
<li><a href="https://github.com/azu/JavaScript-Plugin-Architecture/pull/94" title="refactor(textlint): 敬体(ですます調)と常体(である調)の使い分けを厳密に by azu · Pull Request #94 · azu/JavaScript-Plugin-Architecture">refactor(textlint): 敬体(ですます調)と常体(である調)の使い分けを厳密に by azu · Pull Request #94 · azu/JavaScript-Plugin-Architecture</a> </li>
</ul>
<div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-先ほどのgulpタスクの例では、既にモジュール化された処理を`pipe`で繋げただけであるため、</span>
<span class="gi">+先ほどのgulpタスクの例では、既にモジュール化された処理を`pipe`で繋げただけで、</span>
 それぞれの処理がどのように実装されているかはよく分かりませんでした。
</code></pre></div><div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-BufferはStringと相互変換が可能であるため、多くのgulpプラグインと呼ばれるものは、`gulpPrefixer`と`prefixBuffer`にあたる部分だけを実装しています。</span>
<span class="gi">+BufferはStringと相互変換が可能なので、多くのgulpプラグインと呼ばれるものは、`gulpPrefixer`と`prefixBuffer`にあたる部分だけを実装しています。</span>
</code></pre></div><div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-gulpではプラグインが持つ機能は1つ(単機能)であること推奨しています。</span>
<span class="gi">+gulpではプラグインが持つ機能は1つ(単機能)とすることを推奨しています。</span>
</code></pre></div><div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-`jQuery.fn`の実装を見てみると、実態は`jQuery.prototype`であるため実際にprototype拡張していることがわかります。</span>
<span class="gi">+`jQuery.fn`の実装を見てみると、実態は`jQuery.prototype`なので、prototype拡張していることがわかります。</span>
</code></pre></div><div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-単純なprototype拡張であると言えるので、利点はJavaScriptのprototypeと同様です。</span>
<span class="gi">+単純なprototype拡張なので、利点はJavaScriptのprototypeと同様です。</span>
</code></pre></div><div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">-まだNode.jsで使われているCommonJSやES6 Modulesといったものがなかった時代に作られた仕組みであるため、</span>
<span class="gi">+まだNode.jsで使われているCommonJSやES6 Modulesなどがなかった時代に作られた仕組みなので、</span>
</code></pre></div>
<p>他にいい代替表現など書き方の指摘を募集しています。</p>

<ul>
<li><a href="https://github.com/azu/textlint-rule-no-mix-dearu-desumasu/issues/11" title="Docs: リファクタリング例を募集 · Issue #11 · azu/textlint-rule-no-mix-dearu-desumasu">Docs: リファクタリング例を募集 · Issue #11 · azu/textlint-rule-no-mix-dearu-desumasu</a></li>
</ul>

<p>また、テキストから解析する部分を別途ライブラリとして切り出しているので、これはそもそも&quot;である調&quot;なのか?という問題などがありましたらIssueを立ててください。</p>

<p>イマイチ明確な基準がわかっていないため、false positiveにならないように限定しています。</p>

<ul>
<li><a href="https://github.com/azu/analyze-desumasu-dearu" title="azu/analyze-desumasu-dearu: 文の敬体(ですます調)、常体(である調)を解析するJavaScriptライブラリ">azu/analyze-desumasu-dearu: 文の敬体(ですます調)、常体(である調)を解析するJavaScriptライブラリ</a></li>
</ul>

<p>(本当は<a href="https://github.com/azu/textlint-rule-no-mix-dearu-desumasu/issues/4" title="textlint-rule-no-mix*ed*-dearu-desumasu">textlint-rule-no-mix*ed*-dearu-desumasu</a>の方がESLint的なルール名として正しい…)</p>
 ]]></content>
 </entry>
 
 <entry>
   <title>npmで同じライブラリの複数バージョンをインストールして使う方法</title>
   <link href="http://efcl.info/2016/05/02/npm-package-mixed-multiple-versions-demo/"/>
   <updated>2016-05-02T14:12:00+09:00</updated>
   <id>http://efcl.info/2016/05/02/npm-package-mixed-multiple-versions-demo</id>
   <content type="html"><![CDATA[ <p><a href="https://github.com/fkling/astexplorer/pull/107/files#diff-b9cfc7f2cdf78a7f4b91a753d10865a2R52" title="Add support for ESLint v2 by Daniel15 · Pull Request #107 · fkling/astexplorer">Add support for ESLint v2 by Daniel15 · Pull Request #107 · fkling/astexplorer</a>を見ていて、一つのプロジェクト内で複数のバージョンの同じライブラリを使う面白い方法が使われてたのでメモです。</p>

<p>前述した<a href="https://astexplorer.net/" title="AST explorer">AST explorer</a>の場合だと、ESLint@1とESLint@2の両方に対応したPlaygroundを作りたいため、一つのプロジェクトに両方のバージョンをインストールする必要があるという話です。</p>

<p>他にも、同じライブラリでもβ版は別の名前空間(<code>require(&quot;other-name-space&quot;)</code>)で使って試したいというケースもあると思います。</p>

<ul>
<li><a href="http://ja.stackoverflow.com/questions/9191/%E5%90%8C%E4%B8%80npm%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E5%90%8D%E3%81%AE%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E3%82%B5%E3%83%96%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AF%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B" title="javascript - 同一npmパッケージ名の複数のバージョンをサブディレクトリにインストールすることはできますか? - スタック・オーバーフロー">javascript - 同一npmパッケージ名の複数のバージョンをサブディレクトリにインストールすることはできますか? - スタック・オーバーフロー</a></li>
</ul>

<p>ブラウザだとちょっとファイルサイズ的に避けたい気がしますが、<code>jQuery@1</code>と<code>jquery@3</code>を混在させて使うプロジェクトとかにも応用できそうな気がします。</p>

<h2 id="やり方">やり方</h2>

<p>サンプルプロジェクトは以下においてあります。</p>

<ul>
<li><a href="https://github.com/azu/npm-package-mixed-multiple-versions-demo" title="azu/npm-package-mixed-multiple-versions-demo: Demo project for mixing multiple version of the same npm package in a project.">azu/npm-package-mixed-multiple-versions-demo: Demo project for mixing multiple version of the same npm package in a project.</a></li>
</ul>

<p>このプロジェクトのゴールは<code>lodash@3</code>と<code>lodash@4</code>を同時にひとつのプロジェクトで使うことです(実用性は置いておきます)</p>

<h2 id="1-それぞれのバージョンのローカルパッケージを作る">1. それぞれのバージョンのローカルパッケージを作る</h2>

<p>npm@2 からは<a href="https://docs.npmjs.com/files/package.json#local-paths" title="Local Paths">Local Paths</a>を依存関係として定義することができます。</p>

<p>簡単にいうと、相対パスで指定したディレクトリをモジュールとして<code>dependencies</code>に追加できる機能です。</p>

<ul>
<li><a href="http://efcl.info/2014/10/04/npm2-local-module/" title="npm 2.0.0でローカルパッケージを使ってrequire(&amp;#39;../../../&amp;#39;)を回避する | Web Scratch">npm 2.0.0でローカルパッケージを使ってrequire(&#39;../../../&#39;)を回避する | Web Scratch</a></li>
<li><a href="http://efcl.info/2015/07/29/example-test-on-npm/" title="npmパッケージをExampleテストしよう | Web Scratch">npmパッケージをExampleテストしよう | Web Scratch</a></li>
</ul>

<p>これを使って、<code>lodash@3</code>と<code>lodash@4</code>のローカルパッケージを作ります。</p>

<p><a href="https://github.com/azu/npm-package-mixed-multiple-versions-demo">サンプルプロジェクト</a>を見るのが分かりやすいですが、<code>lodash3</code>と<code>lodash4</code>というディレクトリを手動で作って、それぞれ<code>npm init</code>して<code>main</code>に<code>index.js</code>を指定しただけのモジュールです。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">packages
├── lodash3
│   ├── index.js
│   └── package.json
└── lodash4
    ├── index.js
    └── package.json
</code></pre></div>
<p><code>index.js</code>には以下のようにlodashをexportしているだけです。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// lodash@3
module.exports = require(&quot;lodash&quot;);
</code></pre></div>
<ul>
<li><a href="https://github.com/azu/npm-package-mixed-multiple-versions-demo/blob/master/packages/lodash3/index.js" title="packages/lodash3/index.js">packages/lodash3/index.js</a></li>
</ul>

<p>lodash3のモジュールで<code>require(&quot;lodash&quot;)</code>したのは<a href="https://github.com/azu/npm-package-mixed-multiple-versions-demo/blob/62745c4ee969da1672a6c4c84b929e6946da0e21/packages/lodash3/package.json#L9" title="packages/lodash3/package.json">packages/lodash3/package.json</a>で依存関係に定義されている<code>lodash</code>なので、<code>lodash@3</code>がexportされているという事になります。</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lodash3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;lodash@3&quot;</span><span class="p">,</span>
  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;azu&quot;</span><span class="p">,</span>
  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;lodash&quot;</span><span class="p">:</span> <span class="s2">&quot;^3.0.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="2-ローカルパッケージをインストールする">2. ローカルパッケージをインストールする</h2>

<p>後は、プロジェクトにローカルパッケージとして作った<code>lodash3</code>と<code>lodash4</code>への依存を定義するだけです。</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">npm i -S packages/lodash3 packages/lodash4
</code></pre></div>
<p>でインストールできます。
npmのバージョンによって<code>npm i -S</code>でちゃんと相対パスにならないバグがありますが、直接以下のように書けば同じ結果が得られます。</p>
<div class="highlight"><pre><code class="language-json" data-lang="json">  <span class="s2">&quot;dependencies&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;lodash3&quot;</span><span class="p">:</span> <span class="s2">&quot;file:packages/lodash3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lodash4&quot;</span><span class="p">:</span> <span class="s2">&quot;file:packages/lodash4&quot;</span>
  <span class="p">}</span>
</code></pre></div>
<h2 id="3-それぞれのバージョンを使う">3. それぞれのバージョンを使う</h2>

<p>後は、プロジェクトから<code>require(&quot;lodash3&quot;)</code>のような感じで<code>require</code>して使うだけです。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lodash3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;lodash3&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lodash4</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;lodash4&quot;</span><span class="p">);</span>

<span class="nx">assert</span><span class="p">(</span><span class="nx">lodash3</span><span class="p">.</span><span class="nx">VERSION</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">));</span>
<span class="nx">assert</span><span class="p">(</span><span class="nx">lodash4</span><span class="p">.</span><span class="nx">VERSION</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;4&quot;</span><span class="p">));</span>
</code></pre></div>
<p>lodashには<code>.VERSION</code>にバージョン番号が入ってるので、それぞれ@3と@4のバージョンが読み込めてることが確認できます。</p>

<h2 id="おわり">おわり</h2>

<p>ローカルパッケージを使って、一つのプロジェクト内で複数バージョンのnpmパッケージを使い分ける方法を紹介しました。</p>

<p><a href="https://github.com/fkling/astexplorer" title="astexplorer">astexplorer</a>みたいなツール系だと結構実用的なユースケースだと思います。
普通のウェブサイトとかプロダクトなら、最新のバージョン使おうねって感じです。
(ワークアラウンドとして覚えておくと便利なことがあるかもしれないという感じです)</p>

<p>他にも過去のバージョンとのパフォーマンス比較ポイントを作ったりなどの色々使い道があるかもしれません。</p>

<ul>
<li>サンプル: <a href="https://github.com/azu/npm-package-mixed-multiple-versions-demo" title="azu/npm-package-mixed-multiple-versions-demo: Demo project for mixing multiple version of the same npm package in a project.">azu/npm-package-mixed-multiple-versions-demo: Demo project for mixing multiple version of the same npm package in a project.</a></li>
</ul>
 ]]></content>
 </entry>
 
 <entry>
   <title>#child_process_sushi でJavaScriptアーキテクチャについて話してきた</title>
   <link href="http://efcl.info/2016/04/27/child_process_sushi/"/>
   <updated>2016-04-27T23:40:00+09:00</updated>
   <id>http://efcl.info/2016/04/27/child_process_sushi</id>
   <content type="html"><![CDATA[ <p><a href="https://twitter.com/search?f=tweets&amp;vertical=default&amp;q=%20%23child_process_sushi" title="#child_process_sushi">#child_process_sushi</a>で最近やってたJavaScriptの設計の話をしてきた。</p>

<ul>
<li><a href="http://azu.github.io/slide/2016/child_process_sushi/almin-javascript-architecture.html" title="Almin.js | JavaScriptアーキテクチャ">Almin.js | JavaScriptアーキテクチャ</a></li>
</ul>

<p>Fluxとかで上半分は皆やるようになったけど、ドメインモデルとかFluxの場合にビジネスロジックとかをどこに書くとかはまだ未成熟な気がしているので、そのパターンを考えてて<a href="https://github.com/almin/almin" title="Almin.js">Almin.js</a>というのを書いたという話をした。</p>

<p>Almin自体は大した実装ではないので、サンプルとかドキュメントとしてパターンについて学べるものを書いていきたいイメージ。(このアーキテクチャ話自体は、色々な言語で繰り返しやっては言語が廃れて、パターンがちょっと違う形で残るというのを繰り返している by @t_wada)</p>

<p><img src="http://azu.github.io/slide/2016/child_process_sushi/img/almin-architecture-flux.png" alt="almin"></p>

<p>JavaScriptでもウェブアプリやElectronでのアプリのような、APIを叩いて表示して終わりじゃなくて、ドメインモデルの生存期間が長いものが増えてきているのでその辺を考えていこうという話でした。</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="und" dir="ltr">🍣 <a href="https://twitter.com/hashtag/child_process_sushi?src=hash">#child_process_sushi</a> <a href="https://t.co/CSuqQoDrWj">pic.twitter.com/CSuqQoDrWj</a></p>&mdash; azu (@azu_re) <a href="https://twitter.com/azu_re/status/725281910373511172">April 27, 2016</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>ログ</p>

<ul>
<li><a href="http://togetter.com/li/968216" title="#child_process_sushi - Togetterまとめ">#child_process_sushi - Togetterまとめ</a></li>
</ul>

<h2 id="pathでのxss-kyo_ago">PathでのXSS - kyo_ago</h2>

<blockquote>
<p><a href="https://speakerdeck.com/masatokinugawa/shibuya-dot-xss-techtalk-number-7" title="明日から使える?! PATHでXSSする技術/ Shibuya.XSS techtalk #7 // Speaker Deck">明日から使える?! PATHでXSSする技術/ Shibuya.XSS techtalk #7 // Speaker Deck</a></p>
</blockquote>

<p>の話</p>

<ul>
<li>外部からIEのドキュメントモードを落として表示できるという話</li>
<li>iframe以外でIEのドキュメントモードをダウングレードする方法があったらすごい</li>
</ul>

<h2 id="angular2でニッチなやつ-83">Angular2でニッチなやつ - 83</h2>

<ul>
<li>Upgrading from 1.x</li>
<li>実際にこれをやってる話</li>
<li>Angular 1から2に上げていくパターン</li>
<li>2にあげたものが1のコンポーネントを使うことができる

<ul>
<li>実際にやると死ぬので大変</li>
</ul></li>
<li>npmとして名前が違うので2と1は両方パッケージとして入る</li>
<li>upgrade adaptorというものがあり、これからBootStrapをよぶ必要がある</li>
<li>Angular 1

<ul>
<li>Service

<ul>
<li>いろんな機能を持ってる</li>
</ul></li>
<li>Directive

<ul>
<li>コンポーネント</li>
</ul></li>
</ul></li>
<li>Angular 2

<ul>
<li>コンポーネントの方は移行完了した</li>
</ul></li>
<li>進捗80%で止まりそうな要因はuirouterの移行。</li>
<li>1.xで動いてるrouterなので、2.xに移行するときのボトルネックになる

<ul>
<li>1.x -&gt; 2.x -- 2.xのルーターの世界になる</li>
</ul></li>
</ul>

<hr>

<h1 id="広告の話-jxck">広告の話 - Jxck</h1>

<ul>
<li>HTTP2はRFCが出た</li>
<li>実装 から 使う話になってきた</li>
<li>現状の問題

<ul>
<li>AD問題</li>
<li>TLSの問題</li>
<li>ロードバランスの話</li>
</ul></li>
<li>ADの問題

<ul>
<li><a href="https://speakerdeck.com/suzuken/deisupureiguang-gao-falseji-chu-tosekiyuritei" title="ディスプレイ広告の基礎とセキュリティ // Speaker Deck">ディスプレイ広告の基礎とセキュリティ // Speaker Deck</a></li>
<li>mixed contentの問題</li>
<li>たまに　HTTP で出してくる</li>
<li>コレがおきる業界図</li>
<li>広告主 -&gt; メディア</li>
<li>iframeの入れ子の問題</li>
<li>一番外はHTTPSは保証</li>
<li>中の広告がmixed contentになってることが多い</li>
<li>mixed contentをreportする方法がない</li>
<li>中の広告まで全部制御できてないと全部HTTPSにならない</li>
<li><a href="https://hacks.mozilla.org/2015/09/subresource-integrity-in-firefox-43/">https://hacks.mozilla.org/2015/09/subresource-integrity-in-firefox-43/</a></li>
<li>CORSが必要</li>
<li>入れ子になった中のドメインの内容も推測出来てしまうので、CORSが必要

<ul>
<li>仕様的にはそっちは許可されてない</li>
</ul></li>
</ul></li>
<li>次回はCAの話</li>
</ul>

<hr>

<h1 id="almin-js-javascriptアーキテクチャ-azu"><a href="http://azu.github.io/slide/2016/child_process_sushi/almin-javascript-architecture.html" title="Almin.js | JavaScriptアーキテクチャ">Almin.js | JavaScriptアーキテクチャ</a> - azu</h1>

<ul>
<li>Fluxとかで上半分は皆できるようになったけどドメインモデルについてはまだ未成熟</li>
</ul>

<p><img src="http://azu.github.io/slide/2016/child_process_sushi/img/almin-architecture-flux.png" alt="almin"></p>

<ul>
<li><a href="https://github.com/almin/almin" title="Almin.js">Almin.js</a>はその辺を考える土台とパターンとサンプルを用意するプロジェクト

<ul>
<li>実装自体はFluxと大体同じ</li>
<li>DDDとかその辺をちゃんと実装してオープンソースで読めるものがまだ少ない(JavaScriptだと特に)</li>
</ul></li>
<li>考えて設計して、考えるコードを書く状況をクライアントサイドJavaScriptでも作っていきたい</li>
<li>アーキテクチャは毒

<ul>
<li>この話も何週目 - 世界は繰り返す</li>
</ul></li>
<li>フロントエンド/クライアントサイドでは、バックエンド/サーバサイドよりもオブジェクトの生存期間が長い

<ul>
<li>Gmailのメモリリークの話</li>
<li>クライアントサイドではモデルの生存する時間が数日単位とかある</li>
</ul></li>
<li>この辺の知見はC#がやっぱり多い(クライアントサイドであるため)</li>
<li>言語は死んでもパターンは残るのがパターンは強い</li>
<li>JavaScriptの影響を受けてiOS/Androidでも似たような話がでてたり面白い。</li>
<li>Repositoryと言ってた部分はrelayとかが代わりになったり(サーバサイドとの透過的な扱い)しそう</li>
<li>初期化時にRepositoryとか全部のシングルトンを集めたものを作ってそれを扱うフレームワーク的にすれば、依存関係とかは常に逆になるので気にしなくてよくなりそう

<ul>
<li>Alminはフレームワークにはしたくなかったのでアプリ側でLocatorとかで似たような事を書いてたり</li>
</ul></li>
</ul>

<hr>

<h1 id="node-js-v6-会長">Node.js v6 - 会長</h1>

<ul>
<li><a href="https://speakerdeck.com/yosuke_furukawa/eater" title="eater // Speaker Deck">eater // Speaker Deck</a></li>
<li>テスト = プロセス分離</li>
<li>mockを始末しなくてもプロセスが死んだら死ぬ</li>
<li>テストの時にmockの解放忘れでテストが落ちるのが死ぬ</li>
<li>Async/Syncが混ざって</li>
<li>node test.js で動く</li>
<li>TJ氏

<ul>
<li><a href="https://github.com/visionmedia/expresso">https://github.com/visionmedia/expresso</a></li>
<li>ファイルシステムとかテスト間で依存してるやつがいると死ぬ</li>
<li>RSpecとかみたいのは並列で実行するために、データベースとかも</li>
</ul></li>
<li>ブラウザ</li>
<li>eater

<ul>
<li>モック前提</li>
<li>基本は1ファイル1モック</li>
<li>サブテスト</li>
</ul></li>
<li>deprecatedメッセージでもテスト落ちる</li>
<li>Node.jsにはログの共通インターフェースがない問題</li>
<li>「immutableとか言ってるそうやったらmockできなくなるんじゃないの」</li>
</ul>

<h2 id="testのassertをastで数えるのやつ-teppis">testのassertをASTで数えるのやつ - teppis</h2>

<ul>
<li><a href="http://teppeis.hatenablog.com/entry/2014/12/esplan-new-testing-utility-counting-assertoins-statically" title="おまえは今まで実行したassertの回数を覚えているのか？あるいは新しいアサーションユーティリティのご提案 - teppeis blog">おまえは今まで実行したassertの回数を覚えているのか？あるいは新しいアサーションユーティリティのご提案 - teppeis blog</a>

<ul>
<li>変換しないと意味が分からないコードを書くのはなんか違うのでは</li>
</ul></li>
<li><a href="https://www.jfrog.com/video/artifactory-npm-support/" title="JFrog - Artifactory NPM Support">JFrog - Artifactory NPM Support</a>

<ul>
<li>月 98$ で SaaS</li>
<li>Mavenとかのホスティングとかいろんなパッケージのホステイングできる</li>
<li>npmのregistryとして登録するProxyとして</li>
</ul></li>
<li>社内のキャッシュになかったらpublicへ

<ul>
<li>npmの別registryの登録方法</li>
<li>scoped moduleでregistryの名前空間を分けるといい</li>
</ul></li>
</ul>

<h2 id="ビルド職人を減らしたいという話-vvakame">ビルド職人を減らしたいという話 -- vvakame</h2>

<blockquote>
<p>スライド: <a href="https://gist.github.com/vvakame/45ca8f051e54702071eb88bb1dd8b46e" title="ビルド職人.md">ビルド職人.md</a></p>
</blockquote>

<ul>
<li>設定を共有したい</li>
<li><a href="https://github.com/rocjs/roc" title="rocjs/roc: Modern Application Development Ecosystem">rocjs/roc: Modern Application Development Ecosystem</a></li>
</ul>

<hr>

<h2 id="intersectionobserver-koba04">InterSectionObserver -- koba04</h2>

<ul>
<li><a href="https://github.com/WICG/IntersectionObserver" title="WICG/IntersectionObserver: API Sketch for Intersection Observers">WICG/IntersectionObserver: API Sketch for Intersection Observers</a></li>
<li>画面から離れたら発火するイベント</li>
<li>下まで来たら再読み込みする</li>
<li>今のFirefoxは同期のスクロール処理は警告でるので、似たような事をする</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Performance/Scroll-linked_effects" title="Scroll-linked effects - Mozilla | MDN">Scroll-linked effects - Mozilla | MDN</a></li>
</ul>

<h2 id="最近の辛いこと-t_wada">最近の辛いこと - t_wada</h2>

<ul>
<li><code>deepStrictEqual</code> がブラウザでは動かない</li>
<li>commmonjs assertはdeepEqualまでしかない</li>
<li><a href="https://github.com/sindresorhus/core-assert" title="sindresorhus/core-assert: Node.js `assert` as a standalone module">sindresorhus/core-assert: Node.js <code>assert</code> as a standalone module</a></li>
<li>暗礁に乗り上げた <code>assert.deepStrictEqual</code></li>
<li>ES6時代に対応したdeepEqualが必要</li>
<li>無限Iteratorとかどうするの?</li>
<li>ESLintでキャキャやってるのすごいね</li>
<li>npm3+dedupe+依存モジュールのバージョン違い競合(estraverseとか?)+Browserifyの辛い話

<ul>
<li>ESLintとpower-assertでdudupeの問題が起こることもある</li>
<li>バージョン違いが存在するとネストしてインストールされる</li>
<li>ネストしてインストールされたモジュールをBrowserifyに食べさせるとなぜか絶対パスがビルドファイル内にでてくる、2つ分のファイルが読み込まれたり、dedupeできなかった問題がおきる</li>
<li>後ろ向きな理由でJSHintを使ってる話</li>
</ul></li>
</ul>

<hr>

<h2 id="バッチ処理の依存関係定義が辛い-joker1007">バッチ処理の依存関係定義が辛い - joker1007</h2>

<ul>
<li>簡単なものだったらRakeでもいいけど</li>
<li>複雑になるとRubyでジョブフローを上手くやるものがない

<ul>
<li>オープンソースのいいものがない(Ruby)</li>
<li>rukawa</li>
<li><a href="http://qiita.com/joker1007/items/02b334d1cca76fadaf2c" title="Ruby製のシンプルなワークフローエンジンRukawaの紹介 - Qiita">Ruby製のシンプルなワークフローエンジンRukawaの紹介 - Qiita</a></li>
</ul></li>
<li>Ruby製のワークフローエンジンを作った</li>
</ul>

<hr>

<p>Child Processおめでとうございます。</p>
 ]]></content>
 </entry>
 
 <entry>
   <title>power-assert + babel as a development tool</title>
   <link href="http://efcl.info/2016/04/14/espower-babel-is-deprecated/"/>
   <updated>2016-04-14T19:55:00+09:00</updated>
   <id>http://efcl.info/2016/04/14/espower-babel-is-deprecated</id>
   <content type="html"><![CDATA[ <h2 id="3行まとめ">3行まとめ</h2>

<ul>
<li><a href="https://github.com/power-assert-js/espower-babel" title="espower-babel">espower-babel</a>は役目を終えたので、Deprecated</li>
<li>Babel + power-assertは<a href="https://github.com/power-assert-js/babel-preset-power-assert" title="babel-preset-power-assert">babel-preset-power-assert</a>を使う</li>
<li>コード上は<code>require(&quot;power-assert&quot;)</code>と<code>require(&quot;assert&quot;)</code> どちらでもpower-assert化できるようになった</li>
</ul>

<h2 id="espower-babelは非推奨へ"><a href="https://github.com/power-assert-js/espower-babel" title="espower-babel">espower-babel</a>は非推奨へ</h2>

<p>Babel + Mocha + power-assertの組み合わせを出来るだけ設定ファイルなどを作らずに使える<a href="https://github.com/power-assert-js/espower-babel" title="espower-babel">espower-babel</a>というモジュールを書いていましたが、役目を終えたので非推奨(deprecated)にしました。</p>

<ul>
<li><a href="http://efcl.info/2015/05/10/espower-babel3.0.0/" title="テストコードをES6+power-assertで書けるespower-babel 3.0.0リリース | Web Scratch">テストコードをES6+power-assertで書けるespower-babel 3.0.0リリース | Web Scratch</a></li>
</ul>

<p>理由としては、Babel@6からは設定(ファイル)を必ず必要とするので、<a href="https://github.com/power-assert-js/espower-babel" title="espower-babel">espower-babel</a>をかませる分、柔軟性がなくなったり余計な処理が起きて遅くなるためです。</p>

<p>代わりに<a href="https://www.npmjs.com/package/babel-register" title="babel-register">babel-register</a>と<a href="https://github.com/power-assert-js/babel-preset-power-assert" title="babel-preset-power-assert">babel-preset-power-assert</a>を直接使って、開発時のBabelのビルド設定としてpower-assertを導入する方法を推奨しています。</p>

<p>以下は、power-assert + Mocha + Babel環境を新規インストールする場合の手順ですが、espower-babelからの移行は<a href="https://github.com/power-assert-js/migrate-espower-babel-to-babel-preset-power-assert" title="migrate-espower-babel-to-babel-preset-power-assert">migrate-espower-babel-to-babel-preset-power-assert</a>を使うことで同様のことができるようにしてあります。</p>

<ul>
<li><a href="https://github.com/power-assert-js/migrate-espower-babel-to-babel-preset-power-assert" title="migrate-espower-babel-to-babel-preset-power-assert">migrate-espower-babel-to-babel-preset-power-assert</a></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ npm i -g migrate-espower-babel-to-babel-preset-power-assert
$ cd &lt;該当プロジェクトrootへ&gt;
$ migrate-espower-babel-to-babel-preset-power-assert
</code></pre></div>
<p>でマイグレーションしてくれます。
(自分のプロジェクトをespower-babelから移行するのに書いたので、人により構成が違うため動かないかもしれません。その場合はPull Requestをいただけると助かります。)</p>

<hr>

<p>新規で、power-assert + Mocha + Babel環境(ランタイム変換)を導入する手順です。</p>

<p>サンプルプロジェクト</p>

<ul>
<li><a href="https://github.com/azu/power-assert-as-tool-demo" title="azu/power-assert-as-tool-demo">azu/power-assert-as-tool-demo</a></li>
</ul>

<h2 id="設定方法">設定方法</h2>

<h3 id="必要なモジュールをインストール">必要なモジュールをインストール</h3>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">npm i -D power-assert mocha babel-register babel-preset-power-assert babel-preset-es2015
</code></pre></div>
<p>mochaからテストを実行する際にBabelの変換をするので、<code>babel-register</code>と以下の2つのpresetをインストールします。</p>

<ul>
<li>babel-preset-es2015

<ul>
<li>ES2015の変換を行うpreset</li>
</ul></li>
<li>babel-preset-power-assert

<ul>
<li>power-assert関連のpreset</li>
</ul></li>
</ul>

<h3 id="babelrcを作成"><code>.babelrc</code>を作成</h3>

<p>Babelの設定をするために、<code>.babelrc</code>を次のように作成します。
power-assertは開発ビルド(テスト中)にしか必要ないので、<code>env</code>で振り分けしておきます。
<code>env</code>は<code>NODE_ENV</code>によって振り分けされます。 <code>NODE_ENV=production &lt;コマンド&gt;</code>のような感じで環境変数を指定し、必要なプラグインを分けることができます。
何も指定していない場合は<code>NODE_ENV=development</code>と同じになります。</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;presets&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;es2015&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;development&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;presets&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;power-assert&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="mocha-optsを作成"><code>mocha.opts</code>を作成</h3>

<p>Mochaの設定をする<code>mocha.opts</code>を作成します。</p>

<p><code>test/mocha.opts</code> に以下のように書くだけです。設定ファイルとして作らないで、引数に渡すだけでいいかもしれません。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">--compilers js:babel-register
</code></pre></div>
<p>こうすることで、Mochaのテスト実行時はBabelによる変換がランタイムで行われます。</p>

<h2 id="テストを書く">テストを書く</h2>

<p>次のような足し算をするコードを書いてみます。</p>

<p><code>add.js</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">y</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>これをテストするコードを<code>assert</code>モジュールを使って書いてみます。</p>

<p><code>add-test.js</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// require(&quot;power-assert&quot;) じゃなくて assert でもいい</span>
<span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kr">import</span> <span class="nx">add</span> <span class="nx">from</span> <span class="s2">&quot;../src/add&quot;</span><span class="p">;</span>
<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should return x + y&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span><span class="c1">// &lt;= Wrong</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p><code>$ mocha</code>という感じでテストを実行してみると、このテストは<code>3 == 5</code>となっているので失敗します。</p>

<p><img src="http://efcl.info/wp-content/uploads/2016/04/14-1460632719.png" alt="power-assert result"></p>

<p>テストを失敗すると、power-assertにより構造的な結果が表示されています。
<code>.babelrc</code>の設定にもとづいて変換する際に<code>babel-preset-power-assert</code>が次の2つのことをやっています。</p>

<ol>
<li><code>require(&quot;assert&quot;)</code>を<code>require(&quot;power-assert&quot;)</code>に書き換える</li>
<li><code>assert</code>関数などに仕込みをして、失敗した時に情報をいっぱい表示できるようにする

<ul>
<li>こちらは今までもやっていたこと</li>
</ul></li>
</ol>

<p>これにより、<code>require(&quot;power-assert&quot;)</code>ではなく、ただの<code>require(&quot;assert&quot;)</code>もpower-assert化された状態でassertionが行えるようになっています。</p>

<p>通常今までは、テストコードのみ<code>require(&quot;power-assert&quot;)</code>をして、アプリケーションコード側では<code>require(&quot;assert&quot;)</code>をしていたと思います。</p>

<p>例えば、この<code>add.js</code>の例では引数のチェックに<code>assert</code>を使っています。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">x</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">y</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>なので、次のようなコードを書くと例外を投げるのでテストは失敗します。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;arguments should be type of number&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">add</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>
<p>今までは、ただの<code>assert()</code>だったので、大した情報はでませんでした。
しかし、これもMocha経由で実行してみると、<code>assert(typeof x === &quot;number&quot;);</code>がpower-assert化されています。</p>

<p><img src="http://efcl.info/wp-content/uploads/2016/04/14-1460633294.png" alt="assert to be power-asssert"></p>

<p>これはどういうことになるかというと、コード上でライブラリとして<code>require(&quot;power-assert&quot;)</code>と読み込む必要がなくなり、ツールとしてpower-assertが動くようになった事を意味します。</p>

<p>なので、<code>power-assert</code>を使わなくなった時はツール(具体的には<code>babelrc</code>から)power-assertを外すだけで、コードは一切変更しなくても良くなったということです。</p>

<p>そのため、power-assertは開発用のライブラリからツールという位置づけに変わったという話でした。</p>

<p>サンプルプロジェクト</p>

<ul>
<li><a href="https://github.com/azu/power-assert-as-tool-demo" title="azu/power-assert-as-tool-demo: babel + power-assert preset demo project.">azu/power-assert-as-tool-demo: babel + power-assert preset demo project.</a></li>
</ul>

<h2 id="おまけ">おまけ</h2>

<p>アプリケーションに<code>assert</code>を書くようになったと言っても、今回の<code>add(x ,y)</code>のように決まりきったような引数のチェックを毎回書くのは大変です。</p>

<p>先ほどの<code>add.js</code>は次のような感じでテストすることができます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kr">import</span> <span class="nx">add</span> <span class="nx">from</span> <span class="s2">&quot;../src/add&quot;</span><span class="p">;</span>
<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should return x + y&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;arguments should be type of number&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">add</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">);</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;unreachable line&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">assert</span><span class="p">.</span><span class="nx">AssertionError</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>引数の型違反例外(<code>assert.AssertionError</code>)もテストされていることが分かります。</p>

<p>JSDocから自動でランタイムAssertionを追加してくれる<a href="https://github.com/azu/babel-plugin-jsdoc-to-assert" title="babel-plugin-jsdoc-to-assert">babel-plugin-jsdoc-to-assert</a>を使うことで、<code>add.js</code>から型チェック的な<code>assert</code>は取り除けます。</p>

<ul>
<li><a href="http://efcl.info/2016/03/25/jsdoc-to-assert/" title="JSDocをランタイムassertに変換するBabelプラグインを書いた | Web Scratch">JSDocをランタイムassertに変換するBabelプラグインを書いた | Web Scratch</a></li>
</ul>

<p>具体的には<code>presets</code>に<a href="https://github.com/azu/babel-preset-jsdoc-to-assert" title="azu/babel-preset-jsdoc-to-assert: Babel plugin for jsdoc-to-assert">babel-preset-jsdoc-to-assert</a>を追加して、JSDocを書くだけです。</p>
<div class="highlight"><pre><code class="language-diff" data-lang="diff"><span class="gd">--- a/.babelrc</span>
<span class="gi">+++ b/.babelrc</span>
<span class="gu">@@ -5,6 +5,7 @@</span>
   &quot;env&quot;: {
     &quot;development&quot;: {
       &quot;presets&quot;: [
<span class="gi">+        &quot;jsdoc-to-assert&quot;,</span>
         &quot;power-assert&quot;
       ]
     }

<span class="gh">diff --git a/src/add.js b/src/add.js</span>
<span class="gh">index 4748ae3..5cc3b9c 100644</span>
<span class="gd">--- a/src/add.js</span>
<span class="gi">+++ b/src/add.js</span>
<span class="gu">@@ -1,7 +1,9 @@</span>
 &quot;use strict&quot;;
<span class="gd">-const assert = require(&quot;assert&quot;);</span>
<span class="gi">+/**</span>
<span class="gi">+ * @param {number} x</span>
<span class="gi">+ * @param {number} y</span>
<span class="gi">+ * @returns {Number}</span>
<span class="gi">+ */</span>
 export default function add(x, y) {
<span class="gd">-    assert(typeof x === &quot;number&quot;);</span>
<span class="gd">-    assert(typeof y === &quot;number&quot;);</span>
     return x + y;
<span class="gd">-}</span>
</code></pre></div>
<p>変更したコミット:</p>

<ul>
<li><a href="https://github.com/azu/power-assert-as-tool-demo/pull/1" title="feat(babel): use jsdoc-to-assert by azu · Pull Request #1 · azu/power-assert-as-tool-demo">feat(babel): use jsdoc-to-assert by azu · Pull Request #1 · azu/power-assert-as-tool-demo</a></li>
</ul>

<p><a href="https://github.com/azu/babel-preset-jsdoc-to-assert" title="azu/babel-preset-jsdoc-to-assert: Babel plugin for jsdoc-to-assert">babel-preset-jsdoc-to-assert</a>もpower-assert化できるといいのですが、Babelの変換の仕組み上難しいのでまだできてません。</p>

<p>また、<code>assert</code>をアプリケーション側で使っていた際に、プロダクションビルドからは取り除きたいということがあります。その場合はunassertを使えば、取り除けるので便利です。</p>

<ul>
<li><a href="https://github.com/twada/unassert">twada/unassert: Encourage reliable programming by writing assertions in production code, and compiling them away from release</a></li>
<li><a href="https://github.com/twada/babel-plugin-unassert">twada/babel-plugin-unassert: Babel plugin to encourage reliable programming by writing assertions in production code, and compiling them away from release.</a></li>
</ul>

<p>変更したコミット:</p>

<ul>
<li><a href="https://github.com/azu/power-assert-as-tool-demo/pull/2" title="feat(babel): add unassert in NODE_ENV=production building by azu · Pull Request #2 · azu/power-assert-as-tool-demo">feat(babel): add unassert in NODE_ENV=production building by azu · Pull Request #2 · azu/power-assert-as-tool-demo</a></li>
</ul>

<p>ここまでを全部適応した最終的な<code>.bebelrc</code>は次のような形になっています。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;presets&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;es2015&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;development&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;presets&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;jsdoc-to-assert&quot;</span><span class="p">,</span>
        <span class="s2">&quot;power-assert&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;production&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;plugins&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;babel-plugin-unassert&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><a href="https://github.com/azu/power-assert-as-tool-demo" title="azu/power-assert-as-tool-demo: babel + power-assert preset demo project.">azu/power-assert-as-tool-demo: babel + power-assert preset demo project.</a></li>
</ul>

<h2 id="おわり">おわり</h2>

<ul>
<li>espower-babelはBebel5以下における解だったので、役目はひとまず終わり</li>
<li>普通にコンパイル言語と同じように、デバッグ時のみ情報量の多いassertの適応、プロダクションビルド時は取り除くということができるようになった</li>
<li><a href="https://ja.wikipedia.org/wiki/%E3%83%9B%E3%83%BC%E3%82%A2%E8%AB%96%E7%90%86" title="ホーア論理">ホーア論理</a>的な事前条件は<code>assert</code>やJSDocで、事後条件はテストで保証するみたいなことはやりやすくなった</li>
<li>コード量や実行速度はそこまで変わらずにチェックできることが色々増えた</li>
</ul>
 ]]></content>
 </entry>
 
 <entry>
   <title>Bikeshed.js アウトラインメモ</title>
   <link href="http://efcl.info/2016/04/13/bikeshedjs/"/>
   <updated>2016-04-13T23:11:00+09:00</updated>
   <id>http://efcl.info/2016/04/13/bikeshedjs</id>
   <content type="html"><![CDATA[ <p><a href="http://connpass.com/event/29019/" title="Bikeshed.js - connpass">Bikeshed.js - connpass</a>に参加したメモ</p>

<hr>

<h2 id="『let-vs-const』-yosuke_furukawa">『let vs. const』 @yosuke_furukawa</h2>

<ul>
<li>Effective Java</li>
<li>気持ちはImmutable</li>
<li>スレッドがないJavaScriptだと微妙</li>
<li><code>const</code> だけで防げるのか

<ul>
<li>const + <code>Object.freeze</code></li>
<li>Map+SetとかもImmutableではないのでimmutable.jsなどを使う必要がある</li>
</ul></li>
<li>やる意味

<ul>
<li><code>prefer-const</code></li>
<li>let使うときはforでぶん回す時ぐらい</li>
<li>逆にletつかているところを見ると注意して見るようになった</li>
<li>やりたいことはconst 強制 =&gt; 初学者のミスを減らせる</li>
</ul></li>
<li>基本的には <code>const</code> を使う</li>
</ul>

<hr>

<h2 id="セミコロン付けるつけない-yoshiko_pg">セミコロン付けるつけない - @yoshiko_pg</h2>

<ul>
<li>付ける人が殆ど</li>
</ul>

<hr>

<p><a href="https://app.sli.do/event/rewvfpmz/ask" title="Bikeshed.js">Bikeshed.js</a>のボードを見ながら自転車置場の議論をした。</p>

<p>インデントとか改行位置とかスタイルの話が殆どだった。</p>

<p>自分は設計においてこういうどっちでもいいような議論が多くあると思ってるので、JavaScriptとCSSの設計についてのスライドを用意したけど使わなかったので忘れる。</p>

<ul>
<li><a href="http://azu.github.io/slide/2016/bikeshedjs/javascript-read-write-stack.html">Read/Write Stack | JavaScriptアーキテクチャ</a></li>
<li><a href="http://azu.github.io/slide/2016/bikeshedjs/component-css-architecture.html">コンポーネントとCSSのアーキテクチャ</a></li>
</ul>

<hr>

<h2 id="power-assertがツールになった話-twada">power-assertがツールになった話 - twada</h2>

<ul>
<li><a href="https://github.com/power-assert-js/power-assert/issues/43" title="power-assert make `assert()` of assert module silent · Issue #43 · power-assert-js/power-assert">power-assert make <code>assert()</code> of assert module silent · Issue #43 · power-assert-js/power-assert</a></li>
</ul>

<p>のissueでは、</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>のようなコードをプロダクション側(テストではない)に書いてた時に、<code>assert()</code>の中身がpower-assert化(位置情報などを含んだオブジェクトを返す)されてしまい、常に<code>assert(object)</code>をパスしてしまうという問題。</p>

<p>これは、次のように<code>power-assert</code>が使われていれば解決すること。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;power-assert&quot;</span><span class="p">);</span>
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>そのため、<code>require(&quot;assert&quot;)</code>　を <code>require(&quot;power-assert&quot;)</code> するものが同時に行われればいいということで、<a href="https://www.npmjs.com/package/babel-plugin-empower-assert" title="babel-plugin-empower-assert">babel-plugin-empower-assert</a>というプラグインができた。</p>

<p>しかし、このプラグインはあくまでオプトインなので、既存の<code>babel-plugin-espower</code>だけを使ってる人は自分で以下のように追加する必要がある。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;presets&quot;</span><span class="o">:</span> <span class="p">[</span>
  <span class="p">],</span>
  <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;development&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;plugins&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;babel-plugin-empower-assert&quot;</span><span class="p">,</span>
        <span class="s2">&quot;babel-plugin-espower&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>毎回2つのプラグインをいれるのは面倒だということで、<a href="https://github.com/twada/babel-preset-power-assert" title="babel-preset-power-assert">babel-preset-power-assert</a>という2つのプラグインをまとめたpresetsが追加された。</p>

<p>これにより、<code>require(&quot;power-assert&quot;)</code>ではなく、ただの<code>require(&quot;assert&quot;)</code>もpower-assert化された状態でassertionが行えるようになった。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;development&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;presets&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;babel-preset-power-assert&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>コード上からはNode.jsのassertモジュールに見えるけど、Babelによってpower-assertモジュールに差し替えられるため、power-assertはライブラリではなくツールになったという話。</p>

<hr>

<p>おわり</p>
 ]]></content>
 </entry>
 
 <entry>
   <title>textlintの設定をnpmにあげて使い回す</title>
   <link href="http://efcl.info/2016/04/08/textlint-sharable-config/"/>
   <updated>2016-04-08T21:51:00+09:00</updated>
   <id>http://efcl.info/2016/04/08/textlint-sharable-config</id>
   <content type="html"><![CDATA[ <p>textlint <a href="https://github.com/textlint/textlint/releases/tag/6.2.0" title="6.2.0">6.2.0</a>でSharable Configの機能を追加しました。</p>

<p>これは<code>.textlintrc</code>の中身をnpmパッケージとして公開して、使うときは<code>textlint --config @azu/textlint-config</code> のようにパッケージを指定して使えるという機能です。</p>

<p>簡単にいうと設定を共有する機能です。</p>

<p>ESLintのやつと基本的に同じですが、ESLintと違って<code>&quot;extend&quot;</code>での設定ファイルの継承は対応してません。
多分JavaScriptとしてやった方が良さそうな気がしていて実装してないです。(いい案があればIssueに下さい)</p>

<p><code>.textlintrc</code>はJavaScriptとして以下のような感じで書くことができます。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> 
    <span class="nx">rules</span> <span class="o">:</span> <span class="p">{</span>
    <span class="p">}</span>
 <span class="p">};</span>
</code></pre></div>
<ul>
<li><a href="http://qiita.com/hokaccha/items/6a132af7a28ffd4e9690">ESLintの設定をscoped packageでnpmにあげて使い回す - Qiita</a></li>
<li><a href="http://qiita.com/mysticatea/items/dc35ced6bd5e782f50cd">共有設定でらくらく ESLint - Qiita</a></li>
</ul>

<p>設定ファイルを公開する場合は<code>main</code>のスクリプトに<code>.textlintrc</code>の設定をJavaScriptで書いてexportするだけです。</p>

<p>例えば、<a href="https://github.com/azu/textlint-config-readme">azu/textlint-config-readme: Sharable config for textlint</a>は以下のファイルをpackage.jsonの&quot;main&quot;に指定しているだけです。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;no-todo&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;no-dead-link&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;alex&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;write-good&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;rousseau&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p><code>pacakge.json</code>は次の通り</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;@azu/textlint-config-readme&quot;</span><span class="p">,</span>
  <span class="nt">&quot;repository&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;git+https://github.com/azu/textlint-config-readme.git&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;azu&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;azuciao@gmail.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;homepage&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/azu/textlint-config-readme&quot;</span><span class="p">,</span>
  <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
  <span class="nt">&quot;files&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;src/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lib/&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;bugs&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/azu/textlint-config-readme/issues&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;textlint config module for writing readme&quot;</span><span class="p">,</span>
  <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;textlint-config.js&quot;</span><span class="p">,</span>
  <span class="nt">&quot;directories&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;textlint -c ./textlint-config.js ./*.md&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;keywords&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;textlint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;config&quot;</span>
  <span class="p">],</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;textlint-rule-alex&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;textlint-rule-common-misspellings&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.0.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;textlint-rule-no-dead-link&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;textlint-rule-no-todo&quot;</span><span class="p">:</span> <span class="s2">&quot;^2.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;textlint-rule-rousseau&quot;</span><span class="p">:</span> <span class="s2">&quot;^1.4.1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;textlint-rule-write-good&quot;</span><span class="p">:</span> <span class="s2">&quot;^0.1.4&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;textlint&quot;</span><span class="p">:</span> <span class="s2">&quot;^6.2.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>使うときは</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install -D @azu/textlint-config-readme textlint
</code></pre></div>
<p>でインストールして</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$(npm bin)/textlint --config @azu/textlint-config-readme README.md
</code></pre></div>
<p><code>--config</code>にパッケージ名を指定するだけです。</p>

<p>具体的には以下を見てみてください。</p>

<ul>
<li><a href="https://github.com/azu/textlint-config-readme">azu/textlint-config-readme: Sharable config for textlint</a>

<ul>
<li>README.mdのチェック用のルールを適当にまとめた</li>
</ul></li>
<li><a href="https://github.com/textlint/textlint/blob/master/docs/configuring.md#sharable-configuration">textlint/configuring.md at master · textlint/textlint</a></li>
</ul>

<p>Scoped module(<code>@azu/abc</code>のような形式)も対応してるので、自分の名前空間なら気軽に公開できて便利です。</p>

<ul>
<li><a href="http://efcl.info/2015/04/30/npm-namespace/" title="npmで名前空間を持ったモジュールを公開する方法(scoped modules) | Web Scratch">npmで名前空間を持ったモジュールを公開する方法(scoped modules) | Web Scratch</a></li>
</ul>
 ]]></content>
 </entry>
 

</feed>
