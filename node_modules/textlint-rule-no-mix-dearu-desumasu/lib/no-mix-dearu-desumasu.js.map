{"version":3,"sources":["../src/no-mix-dearu-desumasu.js"],"names":[],"mappings":";AACA,YAAY,CAAC;;;;qBAGW,kBAAkB;;;;kCAFjB,sBAAsB;;oCACJ,wBAAwB;;AACpD,SAAS,kBAAkB,CAAC,OAAO,EAAE;;;QAC3C,MAAM,GAAkC,OAAO,CAA/C,MAAM;QAAE,SAAS,GAAuB,OAAO,CAAvC,SAAS;QAAE,MAAM,GAAe,OAAO,CAA5B,MAAM;QAAE,SAAS,GAAI,OAAO,CAApB,SAAS;;AACzC,QAAI,MAAM,GAAG,mCAAe,OAAO,CAAC,CAAC;AACrC,QAAI,UAAU,YAAA,CAAC;AACf,QAAI,aAAa,YAAA,CAAC;;AAElB,QAAI,YAAY,YAAA,CAAC;AACjB,QAAI,eAAe,YAAA,CAAC;;AAEpB,aAAS,UAAU,GAAG;AAClB,kBAAU,GAAG,CAAC,CAAC;AACf,qBAAa,GAAG,CAAC,CAAC;;AAElB,oBAAY,GAAG,IAAI,CAAC;AACpB,uBAAe,GAAG,IAAI,CAAC;KAC1B;;AAED,6CACK,MAAM,CAAC,QAAQ,EAAG,UAAU,yBAC5B,MAAM,CAAC,GAAG,EAAC,UAAC,IAAI,EAAC;AACd,YAAI,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE;AAC3F,mBAAO;SACV;;;AAGD,YAAI,MAAM,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE;AAC7C,mBAAO;SACV;AACD,YAAI,gBAAgB,GAAG,UAAU,CAAC;AAClC,YAAI,mBAAmB,GAAG,aAAa,CAAC;AACxC,YAAI,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;AAC3B,YAAI,QAAQ,GAAG,wCAAa,IAAI,EAAE,EAAC,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAC;AAC/D,YAAI,WAAW,GAAG,2CAAgB,IAAI,EAAE,EAAC,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAC;AACrE,kBAAU,IAAI,QAAQ,CAAC,MAAM,CAAC;AAC9B,qBAAa,IAAI,WAAW,CAAC,MAAM,CAAC;AACpC,YAAI,gBAAgB,KAAK,UAAU,EAAE;AACjC,wBAAY,GAAG;AACX,oBAAI,EAAJ,IAAI;AACJ,uBAAO,EAAE,QAAQ;aACpB,CAAC;SACL;AACD,YAAI,mBAAmB,KAAK,aAAa,EAAE;AACvC,2BAAe,GAAG;AACd,oBAAI,EAAJ,IAAI;AACJ,uBAAO,EAAE,WAAW;aACvB,CAAC;SACL;KACJ,yBACA,MAAM,CAAC,QAAQ,GAAG,OAAO,EAAC,UAAC,IAAI,EAAC;AAC7B,YAAI,UAAU,KAAK,CAAC,IAAI,aAAa,KAAK,CAAC,EAAE;;AAEzC,mBAAO;SACV;AACD,YAAI,UAAU,GAAG,aAAa,EAAE;;AAE5B,gBAAI,OAAO,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACzC,gBAAI,SAAS,GAAG,IAAI,SAAS,qCACvC,OAAO,CAAC,KAAK,kCAEV,UAAU,gBACX,aAAa,SAClB;AACiB,oBAAI,EAAE,OAAO,CAAC,UAAU,GAAG,CAAC;AAC5B,sBAAM,EAAE,OAAO,CAAC,WAAW;aAC9B,CAAC,CAAC;AACH,kBAAM,CAAC,eAAe,CAAC,IAAI,EAAE,SAAS,CAAC,CAAA;SAC1C,MAAM,IAAI,YAAY,CAAC,OAAO,EAAE;;AAE7B,gBAAI,OAAO,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACtC,gBAAI,SAAS,GAAG,IAAI,SAAS,qCACvC,OAAO,CAAC,KAAK,iCAEV,UAAU,gBACX,aAAa,SAClB;AACiB,oBAAI,EAAE,OAAO,CAAC,UAAU,GAAG,CAAC;AAC5B,sBAAM,EAAE,OAAO,CAAC,WAAW;aAC9B,CAAC,CAAC;;AAEH,kBAAM,CAAC,YAAY,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;SACxC;KACJ,SACJ;CACJ","file":"no-mix-dearu-desumasu.js","sourcesContent":["// LICENSE : MIT\n\"use strict\";\nimport {RuleHelper} from \"textlint-rule-helper\";\nimport {analyzeDesumasu,analyzeDearu} from \"analyze-desumasu-dearu\";\nexport default function noMixDearuDesumasu(context) {\n    let {Syntax, RuleError, report, getSource} = context;\n    let helper = new RuleHelper(context);\n    let dearuCount;\n    let desumasuCount;\n\n    let dearuLastHit;\n    let desumasuLastHit;\n\n    function initialize() {\n        dearuCount = 0;\n        desumasuCount = 0;\n\n        dearuLastHit = null;\n        desumasuLastHit = null;\n    }\n\n    return {\n        [Syntax.Document]: initialize,\n        [Syntax.Str](node){\n            if (helper.isChildNode(node, [Syntax.Link, Syntax.Image, Syntax.BlockQuote, Syntax.Emphasis])) {\n                return;\n            }\n            // 例外) 「です・ます」調の文中の「箇条書き」の部分に「である」調を使う場合\n            // http://www.p-press.jp/correct/mailmagazine/mailmagazine24.html\n            if (helper.isChildNode(node, [Syntax.ListItem])) {\n                return;\n            }\n            let beforeDearuCount = dearuCount;\n            let beforeDesumasuCount = desumasuCount;\n            let text = getSource(node);\n            let retDearu = analyzeDearu(text, {analyzeConjunction: false});\n            let retDesumasu = analyzeDesumasu(text, {analyzeConjunction: false});\n            dearuCount += retDearu.length;\n            desumasuCount += retDesumasu.length;\n            if (beforeDearuCount !== dearuCount) {\n                dearuLastHit = {\n                    node,\n                    matches: retDearu\n                };\n            }\n            if (beforeDesumasuCount !== desumasuCount) {\n                desumasuLastHit = {\n                    node,\n                    matches: retDesumasu\n                };\n            }\n        },\n        [Syntax.Document + \":exit\"](node){\n            if (dearuCount === 0 || desumasuCount === 0) {\n                // No problem\n                return;\n            }\n            if (dearuCount > desumasuCount) {\n                // である優先 => 最後の\"ですます\"を表示\n                let hitNode = desumasuLastHit.matches[0];\n                let ruleError = new RuleError(`\"である\"調 と \"ですます\"調 が混在\n=> \"${hitNode.value}\" がですます調\nTotal:\nである  : ${dearuCount}\nですます: ${desumasuCount}\n`, {\n                    line: hitNode.lineNumber - 1,\n                    column: hitNode.columnIndex\n                });\n                report(desumasuLastHit.node, ruleError)\n            } else if (dearuLastHit.matches) {\n                // ですます優先 => 最後の\"である\"を表示\n                let hitNode = dearuLastHit.matches[0];\n                let ruleError = new RuleError(`\"である\"調 と \"ですます\"調 が混在\n=> \"${hitNode.value}\" がである調\nTotal:\nである  : ${dearuCount}\nですます: ${desumasuCount}\n`, {\n                    line: hitNode.lineNumber - 1,\n                    column: hitNode.columnIndex\n                });\n\n                report(dearuLastHit.node, ruleError);\n            }\n        }\n    }\n}"]}