<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        
        gulp 3.5でgulp.runがdeprecatedになりました | Web Scratch
        
    </title>
    <meta name="description" content="Task runner Build systemツールである[gulp 3.5][1]がリリースされました。">
    
    <meta name="keywords" content="gulp,javascript" />
    
    <meta name="author" content="azu">
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="/public/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/public/favicon.ico">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed/">
    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/main.css">
    <!-- JavaScript -->
    <!-- Open graph tags -->
<meta property="og:title" content="gulp 3.5でgulp.runがdeprecatedになりました">
<meta property="og:type" content="article">
<meta property="og:url" content="http://efcl.info/2014/0125/res3630/">
<meta property="og:image" content="http://efcl.info">

<meta property="og:description" content="Task runner Build systemツールである[gulp 3.5][1]がリリースされました。">
<meta property="og:site_name" content="Web Scratch">




<meta property="article:published_time" content="2014-01-25T00:00:00+09:00">
<meta property="article:author" content="https://www.facebook.com/">

<meta property="og:see_also" content="http://efcl.info/2017/07/17/JavaScript-to-TypeScript/">

<meta property="og:see_also" content="http://efcl.info/2017/07/11/immutable-array/">

<meta property="og:see_also" content="http://efcl.info/2017/07/04/teppeis_sushi/">





<meta property="article:section" content="javascript">





<meta property="article:tag" content="gulp">

<meta property="article:tag" content="javascript">


    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-2184335-8', 'auto');
    ga('send', 'pageview');
</script>
    <script>
var blog_categories = [
{
    "title" : "greasemonkey",
    "count" : 61
},{
    "title" : "ニコニコ動画",
    "count" : 16
},{
    "title" : "小説電子化",
    "count" : 3
},{
    "title" : "vista",
    "count" : 12
},{
    "title" : "firefox",
    "count" : 56
},{
    "title" : "その他",
    "count" : 13
},{
    "title" : "webサービス",
    "count" : 22
},{
    "title" : "software",
    "count" : 58
},{
    "title" : "雑記",
    "count" : 33
},{
    "title" : "まとめ",
    "count" : 11
},{
    "title" : "zaurus",
    "count" : 3
},{
    "title" : "ハードウェア",
    "count" : 8
},{
    "title" : "アドオン",
    "count" : 31
},{
    "title" : "wordpress",
    "count" : 6
},{
    "title" : "javascript",
    "count" : 183
},{
    "title" : "インストール設定",
    "count" : 12
},{
    "title" : "iphone",
    "count" : 10
},{
    "title" : "loox u",
    "count" : 1
},{
    "title" : "tombloo",
    "count" : 3
},{
    "title" : "イベント",
    "count" : 89
},{
    "title" : "userchome.js",
    "count" : 8
},{
    "title" : "jetpack",
    "count" : 7
},{
    "title" : "onenote",
    "count" : 2
},{
    "title" : "nilscript",
    "count" : 4
},{
    "title" : "keysnail",
    "count" : 3
},{
    "title" : "ios",
    "count" : 15
},{
    "title" : "shell",
    "count" : 3
},{
    "title" : "r言語",
    "count" : 2
},{
    "title" : "node.js",
    "count" : 3
},{
    "title" : "mac",
    "count" : 2
},{
    "title" : "github",
    "count" : 11
},{
    "title" : "jekyll",
    "count" : 1
},{
    "title" : "golang",
    "count" : 1
},{
    "title" : "web",
    "count" : 1
},{
    "title" : "スライド",
    "count" : 1
},{
    "title" : "ie",
    "count" : 1
},{
    "title" : "書籍",
    "count" : 2
},{
    "title" : "textlint",
    "count" : 8
}
];
    blog_categories = blog_categories.filter(function(categoryObject){
        return !/^\d+$/.test(categoryObject.title);
    });
</script>
</head>


<body class="layout-reverse theme-base-0d">
<a href="https://github.com/efcl/efcl.github.io" class="github-ribbon">
    <img style="position: fixed; z-index:100; top: 0; right: 0; border: 0;"
         src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
         alt="Fork me on GitHub"
         data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

<header>
    <div class="site-header">
    <img src="/public/img/reimu-right.png" class="header-logo">

    <h1 class="site-title">
        <a href="/">
            Web Scratch
        </a>
    </h1>
    <p class="lead">ブラウザ/JavaScript等についてのブログ</p>

</div>
</header>
<aside>
    <div class="sidebar">
    <div class="container">
        <div class="profile">
            <a href="/about/" title="About"><img src="/public/img/azu.png" alt="Profile"></a>

            <h2><a href="/about/" title="About">azu</a></h2>
        </div>
        <div class="social">
            <a class="twitter" href="http://twitter.com/azu_re" title="Twitter">
                <img src="/public/svg/twitter.svg" alt="twitter" width="32" height="32"/>
            </a>
            <a class="github" href="https://github.com/azu" title="GitHub">
                <img src="/public/svg/github.svg" alt="GitHub" width="32" height="32"/>
            </a>
            <a class="rss" href="/feed/" title="RSS Feed">
                <img src="/public/svg/feed.svg" alt="RSS" width="32" height="32"/>
            </a>
        </div>
        <nav class="sidebar-nav">
            <div class="search">
                <form class="search-box" method="get" action="https://www.google.co.jp/search">
                    <label for="search-box-label">検索:</label>
                    <input type="hidden" name="q" value="site:efcl.info">
                    <input id="search-box-label" type="search" name="q">
                    <input type="submit" value="search">
                </form>
            </div>
            <div class="recent">
    <h3 class="recent-posts-list-title">
        <a href="/">最近の投稿</a>
    </h3>
    <ul class="recent-posts">
        
        <li>
            <a href="/2017/07/17/JavaScript-to-TypeScript/">
                JavaScriptのライブラリを徐々にTypeScriptに移行する
            </a>
        </li>
        
        <li>
            <a href="/2017/07/11/immutable-array/">
                Array.prototypeのImmutable版メソッドを個別のパッケージで使えるものを作った
            </a>
        </li>
        
        <li>
            <a href="/2017/07/04/teppeis_sushi/">
                #teppeis_sushi でクライアントサイドDDDについて発表した
            </a>
        </li>
        
        <li>
            <a href="/2017/05/29/gitbook-plugin-github-issue-for-review/">
                書いた文章をレビューしてGitHubにIssueを切るためのGitBookプラグイン
            </a>
        </li>
        
    </ul>
</div>
            <div class="recent">
    <h3 class="categories-list-title"><a href="/categories">カテゴリ一覧</a></h3>

    <div class="categories-list" id="js-categories-list">

    </div>
    <script>
        (function () {
            var categoriesList = window.blog_categories;
            var appendPoint = document.getElementById("js-categories-list");
            // big ... small
            var sortedCategories = categoriesList.sort(function (a, b) {
                return a.count < b.count ? 1 : -1;
            });
            var ulTag = document.createElement("ul");
            var displayCount = sortedCategories.length < 3 ? sortedCategories.length : 3;
            for (var i = 0; i < displayCount; i++) {
                var category = sortedCategories[i];
                var liTag = document.createElement("li");
                var aTag = document.createElement("a");
                aTag.href = "/categories#" + category.title;
                aTag.textContent = category.title;
                var spanTag = document.createElement("span");
                spanTag.appendChild(document.createTextNode("[" + category.count + "]"));
                liTag.appendChild(aTag);
                liTag.appendChild(spanTag);
                ulTag.appendChild(liTag);
            }
            var lastLiTag = document.createElement("li");
            var lastATag = document.createElement("a");
            lastATag.href = "/categories";
            lastATag.textContent = "その他のタグ…";
            lastLiTag.appendChild(lastATag);
            ulTag.appendChild(lastATag);
            appendPoint.appendChild(ulTag);
        })();
    </script>
</div>
        </nav>
    </div>
</div>

</aside>
<article>
    <div class="content container">
        <div class="post" id="js-post-url" data-post-url="/2014/0125/res3630/">
    <h1 class="post-title">gulp 3.5でgulp.runがdeprecatedになりました</h1>

    <div class="pre-post-toolbar">
        <span class="post-date">2014年01月25日</span>
        <a class="btn edit-on-github" href="https://github.com/efcl/efcl.github.io/edit/develop/_posts/2014/2014-01-25-gulp-3-5%E3%81%A7gulp-run%E3%81%8Cdeprecated%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F.md"><span class="edito-on-github-label"></span>Edit on GitHub</a>

    </div>
    <div class="post-content">
        <p><del>Task runner</del> Build systemツールである<a href="https://github.com/gulpjs/gulp/blob/master/CHANGELOG.md#35" title="3.5">gulp 3.5</a>がリリースされました。</p>

<h3 id="変更点">変更点</h3>

<p><a href="https://github.com/gulpjs/gulp/blob/master/CHANGELOG.md#35" title="gulp/CHANGELOG.md at master · gulpjs/gulp">gulp/CHANGELOG.md at master · gulpjs/gulp</a> に変更点が幾つか載っていますが、<br>
以下の2点は今までにgulpfileを書いてきた人は影響があると思います。(公式のreadmeとかもそうだったので)</p>

<ul>
<li>  added <code>gulp.watch(globs, tasksArray)</code> sugar</li>
<li>  deprecate <code>gulp.run</code></li>
</ul>

<p><code>gulp.run</code> が 以下のような議論/問題点を経て非推奨になっています。</p>

<ul>
<li>  <a href="https://github.com/gulpjs/gulp/pull/162" title="Avoid promoting gulp.run by robrich · Pull Request #162 · gulpjs/gulp">Avoid promoting gulp.run by robrich · Pull Request #162 · gulpjs/gulp</a></li>
<li>  要はタスクの依存関係のために <code>gulp.run</code> を使うと問題がでるケースがある</li>
</ul>

<p>そのため、以下のようなタスクを実装すると</p>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task('default', function () {<br />
    gulp.run('build');<br />
});<br />
-->

<blockquote>
<p>gulp.run() has been deprecated. Use task dependencies or gulp.watch task triggering instead. </p>
</blockquote>

<p>という警告が出るようになったと思います(3.5から)</p>

<p>これをどう書き換えるかというと、<code>gulp.run</code> ではなくて、<code>gulp.task</code> や <code>gulp.watch</code> にはタスク同士の依存関係を定義する方法があるので、そちらに書き換えます。</p>

<h3 id="書き換え">書き換え</h3>

<p><a href="http://efcl.info/2014/0120/res3605/" title="npmとbrowserifyを使ったクライアントサイドのウェブアプリ開発 | Web scratch">npmとbrowserifyを使ったクライアントサイドのウェブアプリ開発 | Web scratch</a> で紹介した<a href="https://github.com/azu/tech-video-rss-searcher/" title="azu/tech-video-rss-searcher">azu/tech-video-rss-searcher</a>を例に書き換えてみます。</p>

<p>書き換え前の<a href="https://github.com/azu/tech-video-rss-searcher/blob/ef0853ed723cacb49ac121a9462193426665534b/gulpfile.js" title="gulpfile.js">gulpfile.js</a>は以下のような感じです。</p>

<div class="highlight">
  <pre><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gutil</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"gulp-util"</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-browserify&#39;</span><span class="p">);</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;./app/app.js&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">read</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">browserify</span><span class="p">({</span>
            <span class="nx">transform</span><span class="o">:</span> <span class="p">[</span><span class="s2">"debowerify"</span><span class="p">],</span>
            <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;./public/&#39;</span><span class="p">));</span>
<span class="p">});</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./app/**/*.js&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// alt : `beefy app/app.js:public/app.js 8989 -- -t debowerify`</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">"server"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"connect"</span><span class="p">);</span>
    <span class="nx">connect</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">)).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8989</span><span class="p">);</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">"watch"</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

<p>これを元に、3.5向け(書き換えなくても警告がでるだけなので4.0がくるまでは動くと思いますが)に書き換えてみます。</p>

<h4 id="gulp-taskの依存">gulp.taskの依存</h4>

<p>最初に紹介したような <code>gulp.task</code> を実行するtaskの場合</p>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task('default', function () {<br />
    gulp.run('build');<br />
});<br />
-->

<p>これは、以下のように <code>gulp.task</code> の第二引数で依存するtaskに書き換えられます。</p>

<ul>
<li>  Doc : <a href="https://github.com/gulpjs/gulp/blob/master/docs/API.md" title=" gulp.task(name[, deps], fn)">gulp.task(name[, deps], fn)</a></li>
</ul>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]);</span>
</pre>
</div>

<!--<br />
gulp.task('default', ['build']);<br />
-->

<h4 id="依存するtask-処理の場合">依存するtask + 処理の場合</h4>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">"server"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">"watch"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"connect"</span><span class="p">);</span>
    <span class="nx">connect</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">)).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8989</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task("server", function () {<br />
    gulp.run("watch");<br />
    var connect = require("connect");<br />
    connect().use(connect.static(__dirname)).listen(8989);<br />
});<br />
-->

<p>これは以下のように書き換え出来ます。</p>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">"server"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"watch"</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"connect"</span><span class="p">);</span>
    <span class="nx">connect</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">)).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8989</span><span class="p">);</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task("server", ["watch"], function () {<br />
    var connect = require("connect");<br />
    connect().use(connect.static(__dirname)).listen(8989);<br />
});<br />
-->

<h4 id="gulp-watch-の依存関係">gulp.watch の依存関係</h4>

<p>以下のように <code>gulp.watch</code> が <code>gulp.run</code> を読んでいる場合も同じように書き換えることが出来ます。</p>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./app/**/*.js&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task('watch', function () {<br />
    gulp.run('build');<br />
    gulp.watch('./app/**/*.js', function (event) {<br />
        gulp.run('build');<br />
    });<br />
});<br />
-->

<p>gulp.watch も 第二引数に依存するtaskを渡すことで同様の処理を書けます。</p>

<div class="highlight">
  <pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./app/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre>
</div>

<!--<br />
gulp.task('watch', ['build'], function () {<br />
    gulp.watch('./app/**/*.js', ['build']);<br />
});<br />
-->

<p>この時は <code>build</code> されてから、第三引数のfunctionが呼ばれます。</p>

<p>これで警告がでる部分がなくなりました</p>

<p><strong>書き換え後</strong> は以下のようになりました</p>

<div class="highlight">
  <pre><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gutil</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"gulp-util"</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-browserify&#39;</span><span class="p">);</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;./app/app.js&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">read</span><span class="o">:</span> <span class="kc">false</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">browserify</span><span class="p">({</span>
            <span class="nx">transform</span><span class="o">:</span> <span class="p">[</span><span class="s2">"debowerify"</span><span class="p">],</span>
            <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;./public/&#39;</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;watch&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./app/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="c1">// alt : `beefy app/app.js:public/app.js 8989 -- -t debowerify`</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s2">"server"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"watch"</span><span class="p">],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"connect"</span><span class="p">);</span>
    <span class="nx">connect</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">connect</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">)).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8989</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build&#39;</span><span class="p">]);</span>
</pre>
</div>

<p>Diffは以下で見られます。</p>

<ul>
<li>  <a href="https://github.com/azu/tech-video-rss-searcher/commit/4ac9dca709f8e90f7a228b39a45b96e47a0ad5a1?w=1">https://github.com/azu/tech-video-rss-searcher/commit/4ac9dca709f8e90f7a228b39a45b96e47a0ad5a1</a></li>
</ul>

<p>今回の書き換えたtaskの依存関係の書き方については以下のドキュメントに書かれています。</p>

<ul>
<li>  <a href="https://github.com/gulpjs/gulp/blob/master/docs/API.md" title="gulp/docs/API.md at master · gulpjs/gulp">gulp/docs/API.md at master · gulpjs/gulp</a></li>
<li>  <a href="https://github.com/gulpjs/gulp/blob/master/docs/recipes/running-tasks-in-series.md" title="gulp/docs/recipes/running-tasks-in-series.md at master · gulpjs/gulp">gulp/docs/recipes/running-tasks-in-series.md at master · gulpjs/gulp</a></li>
<li>  内部的に使ってるモジュール <a href="https://github.com/robrich/orchestrator" title="robrich/orchestrator">robrich/orchestrator</a></li>
</ul>

<h3 id="おわりに">おわりに</h3>

<p><a href="http://gulpjs.com/" title="gulp">gulp</a> 3.5のdeprecate <code>gulp.run</code> は、<br>
gulp taskの依存関係のために <code>gulp.run</code> を使うのは辞めるべきという事で非推奨になったので、<br>
<code>gulp.run</code> のような事を必要とする場面はまだあるとは思います。</p>

<p>そういう時は、gulpfileはただのJavaScriptであるということを思い出して、普通に関数を作ってみるといいのかもしれません。</p>

<blockquote>
<p>If gulp was a task runner I would agree with you. gulp is a build system helper, the task system is out of necessity. We are trying to ween people off of this and onto vanilla JS stuff. JS has an awesome task running system called functions that works really well. </p>
</blockquote>

<ul>
<li>  <a href="https://github.com/gulpjs/gulp/issues/193" title="Deprecating gulp.run no longer allows defining logic before running tasks. · Issue #193 · gulpjs/gulp">Deprecating gulp.run no longer allows defining logic before running tasks. · Issue #193 · gulpjs/gulp</a></li>
</ul>

<p>gulpはtask runnerではなく、build system helperであり、JavaScriptには関数と呼ばれるタスクを実行する仕組みが既にあるためdeprecateになった感じです。</p>

<p>gulpは<a href="https://github.com/gulpjs/gulp/tree/master/docs/writing-a-plugin">APIデザイン</a>的な話が結構でてくるので見ていて面白い感じがします。</p>

    </div>
    <div class="post-post-toolbar">
        <a class="btn edit-on-github"
           href="https://github.com/efcl/efcl.github.io/edit/develop/_posts/2014/2014-01-25-gulp-3-5%E3%81%A7gulp-run%E3%81%8Cdeprecated%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F.md"><span
                class="edit-on-github-label"></span>修正リクエストをする</a>
        <nav class="tags"
             id="js-post-tags"
             data-post-tags='["gulp","javascript"]'>
            <span>タグ:</span>
            <ul>
                
                <li><a href="/tags/?q=gulp">gulp</a></li>
                
                <li><a href="/tags/?q=javascript">javascript</a></li>
                
            </ul>
        </nav>
    </div>
    <div class="announce-area">
        <h3>お知らせ欄</h3>
        <div class="announce-text">
            <!--お知らせ-->
JavaScriptに関する最新情報は週一で<a href="http://jser.info/" title="JSer.info">JSer.info</a>を更新しています。

        </div>
        <h3>次に書くかもしれない記事候補</h3>
        <p>興味がありましたら<a href="https://github.com/efcl/efcl.github.io/labels/%E8%A8%98%E4%BA%8B%E5%80%99%E8%A3%9C" title="Issues · efcl/efcl.github.io">Issues · efcl/efcl.github.io</a>からご意見下さい</p>
        <div class="announce-text">
            <iframe src="https://azu.github.io/github-issue-widget/?owner=efcl&repo=efcl.github.io&labels=記事候補&limit=4&random"
                    allowtransparency="true" frameborder="0" scrolling="0" width="100%" height="100%"></iframe>
        </div>
    </div>
    <div class="related-articles" id="js-related-articles">
        <h3>関連記事</h3>
    </div>
</div>
<div class="zenback-embed">
    <!-- X:S ZenBackWidget --><div id="zenback-widget-loader"></div><script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var r=Math.ceil((new Date()*1)*Math.random());var j=d.createElement("script");j.id=i;j.async=true;j.src="//w.zenback.jp/v1/?base_uri=http%3A//efcl.info/&nsid=89229392978401102%3A%3A89229398078677080&rand="+r;d.body.appendChild(j);}}(document,"zenback-widget-js");</script><!-- X:E ZenBackWidget -->
</div>
<div class="disqus-embed" id="js-disqus-embed">
    <button class="comment-button" id="js-comment-button">コメントを表示</button>
</div>

<script type="text/javascript" src="/public/js/tag-fetcher.js"></script>
<script type="text/javascript" src="/public/js/show-related-article.js"></script>
<script type="text/javascript" src="/public/js/show-disqus.js"></script>

    </div>
</article>
</body>
</html>
